     1                                  %line 8+1 bios.asm
     9                                  [cpu 8086]
    10                                  
    11                                  
    12                                  
    13                                  
    14                                  
    15                                  %line 17+1 bios.asm
    18                                  
    19                                  %line 21+1 bios.asm
    22                                  
    23                                  %line 25+1 bios.asm
    26                                  
    27                                  %line 29+1 bios.asm
    30                                  
    31                                  [org 100h]
    32                                  
    33                                  main:
    34                                  
    35 00000000 EB56                     jmp bios_entry
    36                                  
    37                                  
    38                                  
    39 00000002 [B016]                   dw rm_mode12_reg1
    40 00000004 [9816]                   dw rm_mode012_reg2
    41 00000006 [B816]                   dw rm_mode12_disp
    42 00000008 [C016]                   dw rm_mode12_dfseg
    43 0000000A [9016]                   dw rm_mode0_reg1
    44 0000000C [9816]                   dw rm_mode012_reg2
    45 0000000E [A016]                   dw rm_mode0_disp
    46 00000010 [A816]                   dw rm_mode0_dfseg
    47 00000012 [C816]                   dw xlat_ids
    48 00000014 [C817]                   dw ex_data
    49 00000016 [C818]                   dw std_flags
    50 00000018 [F11C]                   dw parity
    51 0000001A [C819]                   dw base_size
    52 0000001C [C81A]                   dw i_w_adder
    53 0000001E [C81B]                   dw i_mod_adder
    54 00000020 [D11C]                   dw jxx_dec_a
    55 00000022 [D91C]                   dw jxx_dec_b
    56 00000024 [E11C]                   dw jxx_dec_c
    57 00000026 [E91C]                   dw jxx_dec_d
    58 00000028 [C81C]                   dw flags_mult
    59                                  
    60                                  
    61                                  
    62 0000002A 3830383674696E7920-     biosstr db '8086tiny BIOS Revision 1.61!', 0, 0
    62 00000033 42494F532052657669-
    62 0000003C 73696F6E20312E3631-
    62 00000045 210000             
    63 00000048 EA000100F030332F30-     mem_top db 0xea, 0, 0x01, 0, 0xf0, '03/08/14', 0, 0xfe, 0
    63 00000051 382F313400FE00     
    64                                  
    65                                  bios_entry:
    66                                  
    67                                  
    68                                  
    69 00000058 BC00F0                   mov sp, 0xf000
    70 0000005B 8ED4                     mov ss, sp
    71                                  
    72 0000005D 0E                       push cs
    73 0000005E 07                       pop es
    74                                  
    75 0000005F 50                       push ax
    76                                  
    77                                  
    78                                  
    79                                  
    80                                  
    81                                  
    82                                  
    83                                  
    84 00000060 FC                       cld
    85                                  
    86 00000061 31C0                     xor ax, ax
    87 00000063 BF1800                   mov di, 24
    88 00000066 AB                       stosw
    89 00000067 BF3100                   mov di, 49
    90 0000006A AA                       stosb
    91                                  
    92                                  
    93                                  
    94 0000006B 2E8816[7614]             mov [cs:boot_device], dl
    95                                  
    96                                  
    97                                  
    98 00000070 52                       push dx
    99                                  
   100 00000071 BAB803                   mov dx, 0x3b8
   101 00000074 B000                     mov al, 0
   102 00000076 EE                       out dx, al
   103                                  
   104 00000077 BAB403                   mov dx, 0x3b4
   105 0000007A B001                     mov al, 1
   106 0000007C EE                       out dx, al
   107 0000007D BAB503                   mov dx, 0x3b5
   108 00000080 B02D                     mov al, 0x2d
   109 00000082 EE                       out dx, al
   110 00000083 BAB403                   mov dx, 0x3b4
   111 00000086 B006                     mov al, 6
   112 00000088 EE                       out dx, al
   113 00000089 BAB503                   mov dx, 0x3b5
   114 0000008C B057                     mov al, 0x57
   115 0000008E EE                       out dx, al
   116                                  
   117 0000008F 5A                       pop dx
   118                                  
   119 00000090 58                       pop ax
   120                                  
   121                                  
   122                                  
   123 00000091 2E803E[740F]00           cmp byte [cs:boot_state], 0
   124 00000097 7403E9A700               jne boot
   125                                  
   126 0000009C 2EC606[740F]01           mov byte [cs:boot_state], 1
   127                                  
   128                                  
   129                                  
   130                                  
   131                                  
   132                                  
   133                                  
   134                                  
   135 000000A2 89CA                     mov dx, cx
   136 000000A4 89C1                     mov cx, ax
   137                                  
   138 000000A6 2E8916[620F]             mov [cs:hd_secs_hi], dx
   139 000000AB 2E890E[640F]             mov [cs:hd_secs_lo], cx
   140                                  
   141 000000B0 83F900                   cmp cx, 0
   142 000000B3 7409                     je maybe_no_hd
   143                                  
   144 000000B5 2EC706[600F]0200         mov word [cs:num_disks], 2
   145 000000BC EB15                     jmp calc_hd
   146                                  
   147                                  maybe_no_hd:
   148                                  
   149 000000BE 83FA00                   cmp dx, 0
   150 000000C1 7409                     je no_hd
   151                                  
   152 000000C3 2EC706[600F]0200         mov word [cs:num_disks], 2
   153 000000CA EB07                     jmp calc_hd
   154                                  
   155                                  no_hd:
   156                                  
   157 000000CC 2EC706[600F]0100         mov word [cs:num_disks], 1
   158                                  
   159                                  calc_hd:
   160                                  
   161 000000D3 89C8                     mov ax, cx
   162 000000D5 2EC706[680F]0100         mov word [cs:hd_max_track], 1
   163 000000DC 2EC706[6A0F]0100         mov word [cs:hd_max_head], 1
   164                                  
   165 000000E3 83FA00                   cmp dx, 0
   166 000000E6 770B                     ja sect_overflow
   167 000000E8 83F83F                   cmp ax, 63
   168 000000EB 7706                     ja sect_overflow
   169                                  
   170 000000ED 2EA3[660F]               mov [cs:hd_max_sector], ax
   171 000000F1 EB10                     jmp calc_heads
   172                                  
   173                                  sect_overflow:
   174                                  
   175 000000F3 B93F00                   mov cx, 63
   176 000000F6 F7F1                     div cx
   177 000000F8 2EA3[680F]               mov [cs:hd_max_track], ax
   178 000000FC 2EC706[660F]3F00         mov word [cs:hd_max_sector], 63
   179                                  
   180                                  calc_heads:
   181                                  
   182 00000103 BA0000                   mov dx, 0
   183 00000106 2EA1[680F]               mov ax, [cs:hd_max_track]
   184 0000010A 3D0004                   cmp ax, 1024
   185 0000010D 7702                     ja track_overflow
   186                                  
   187 0000010F EB10                     jmp calc_end
   188                                  
   189                                  track_overflow:
   190                                  
   191 00000111 B90004                   mov cx, 1024
   192 00000114 F7F1                     div cx
   193 00000116 2EA3[6A0F]               mov [cs:hd_max_head], ax
   194 0000011A 2EC706[680F]0004         mov word [cs:hd_max_track], 1024
   195                                  
   196                                  calc_end:
   197                                  
   198                                  
   199                                  
   200                                  
   201 00000121 2EA1[6A0F]               mov ax, [cs:hd_max_head]
   202 00000125 2EA2[420F]               mov [cs:int41_max_heads], al
   203 00000129 2EA1[680F]               mov ax, [cs:hd_max_track]
   204 0000012D 2EA3[400F]               mov [cs:int41_max_cyls], ax
   205 00000131 2EA1[660F]               mov ax, [cs:hd_max_sector]
   206 00000135 2EA2[4E0F]               mov [cs:int41_max_sect], al
   207                                  
   208 00000139 2EFF0E[680F]             dec word [cs:hd_max_track]
   209 0000013E 2EFF0E[6A0F]             dec word [cs:hd_max_head]
   210                                  
   211                                  
   212                                  
   213 00000143 B80000                  boot: mov ax, 0
   214 00000146 50                       push ax
   215 00000147 9D                       popf
   216                                  
   217 00000148 0E                       push cs
   218 00000149 0E                       push cs
   219 0000014A 1F                       pop ds
   220 0000014B 17                       pop ss
   221 0000014C BC00F0                   mov sp, 0xf000
   222                                  
   223                                  
   224                                  
   225 0000014F FC                       cld
   226                                  
   227 00000150 31C0                     xor ax, ax
   228 00000152 8EC0                     mov es, ax
   229 00000154 31FF                     xor di, di
   230 00000156 B90002                   mov cx, 512
   231 00000159 F3AB                     rep stosw
   232                                  
   233                                  
   234                                  
   235 0000015B BF0000                   mov di, 0
   236 0000015E BE[D915]                 mov si, int_table
   237 00000161 8B0E[5316]               mov cx, [itbl_size]
   238 00000165 F3A4                     rep movsb
   239                                  
   240                                  
   241                                  
   242 00000167 B9[400F]                 mov cx, int41
   243 0000016A 26890E0401               mov word [es:4*0x41], cx
   244 0000016F B900F0                   mov cx, 0xf000
   245 00000172 26890E0601               mov word [es:4*0x41 + 2], cx
   246                                  
   247                                  
   248                                  
   249 00000177 B8FFFF                   mov ax, 0xffff
   250 0000017A 8EC0                     mov es, ax
   251 0000017C BF0000                   mov di, 0
   252 0000017F BE[4800]                 mov si, mem_top
   253 00000182 B91000                   mov cx, 16
   254 00000185 F3A4                     rep movsb
   255                                  
   256                                  
   257                                  
   258 00000187 B84000                   mov ax, 0x40
   259 0000018A 8EC0                     mov es, ax
   260 0000018C BF0000                   mov di, 0
   261 0000018F BE[DA13]                 mov si, bios_data
   262 00000192 B90001                   mov cx, 0x100
   263 00000195 F3A4                     rep movsb
   264                                  
   265                                  
   266                                  
   267 00000197 B800B8                   mov ax, 0xb800
   268 0000019A 8EC0                     mov es, ax
   269 0000019C BF0000                   mov di, 0
   270 0000019F B9D007                   mov cx, 80*25
   271 000001A2 B80007                   mov ax, 0x0700
   272 000001A5 F3AB                     rep stosw
   273                                  
   274                                  
   275                                  
   276 000001A7 B800C8                   mov ax, 0xc800
   277 000001AA 8EC0                     mov es, ax
   278 000001AC BF0000                   mov di, 0
   279 000001AF B9D007                   mov cx, 80*25
   280 000001B2 B80007                   mov ax, 0x0700
   281 000001B5 F3AB                     rep stosw
   282                                  
   283                                  
   284                                  
   285 000001B7 BA6100                   mov dx, 0x61
   286 000001BA B000                     mov al, 0
   287 000001BC EE                       out dx, al
   288                                  
   289 000001BD BA6000                   mov dx, 0x60
   290 000001C0 EE                       out dx, al
   291                                  
   292 000001C1 BA6400                   mov dx, 0x64
   293 000001C4 EE                       out dx, al
   294                                  
   295 000001C5 BA0000                   mov dx, 0
   296 000001C8 B0FF                     mov al, 0xFF
   297                                  
   298                                  next_out:
   299                                  
   300 000001CA 42                       inc dx
   301                                  
   302 000001CB 83FA40                   cmp dx, 0x40
   303 000001CE 74FA                     je next_out
   304 000001D0 83FA42                   cmp dx, 0x42
   305 000001D3 74F5                     je next_out
   306 000001D5 81FAB803                 cmp dx, 0x3B8
   307 000001D9 74EF                     je next_out
   308 000001DB 83FA60                   cmp dx, 0x60
   309 000001DE 74EA                     je next_out
   310 000001E0 83FA61                   cmp dx, 0x61
   311 000001E3 74E5                     je next_out
   312 000001E5 83FA64                   cmp dx, 0x64
   313 000001E8 74E0                     je next_out
   314                                  
   315 000001EA EE                       out dx, al
   316                                  
   317 000001EB 81FAFF0F                 cmp dx, 0xFFF
   318 000001EF 7CD9                     jl next_out
   319                                  
   320 000001F1 B000                     mov al, 0
   321                                  
   322 000001F3 BADA03                   mov dx, 0x3DA
   323 000001F6 EE                       out dx, al
   324                                  
   325 000001F7 BABA03                   mov dx, 0x3BA
   326 000001FA EE                       out dx, al
   327                                  
   328 000001FB BAB803                   mov dx, 0x3B8
   329 000001FE EE                       out dx, al
   330                                  
   331 000001FF BABC03                   mov dx, 0x3BC
   332 00000202 EE                       out dx, al
   333                                  
   334 00000203 BA6200                   mov dx, 0x62
   335 00000206 EE                       out dx, al
   336                                  
   337                                  
   338                                  
   339 00000207 0E                       push cs
   340 00000208 07                       pop es
   341 00000209 BB[F11D]                 mov bx, timetable
   342                                  %line 19+1 bios.asm
    20 0000020C 0F01                     db 0x0f, 0x01
    21                                  %line 342+1 bios.asm
   343 0000020E 26A1[151E]               mov ax, [es:tm_msec]
   344 00000212 2EA3[8D16]               mov [cs:last_int8_msec], ax
   345                                  
   346                                  
   347                                  
   348 00000216 B80000                   mov ax, 0
   349 00000219 8EC0                     mov es, ax
   350                                  
   351 0000021B B80102                   mov ax, 0x0201
   352 0000021E B600                     mov dh, 0
   353 00000220 2E8A16[7614]             mov dl, [cs:boot_device]
   354 00000225 B90100                   mov cx, 1
   355 00000228 BB007C                   mov bx, 0x7c00
   356 0000022B CD13                     int 13h
   357                                  
   358                                  
   359                                  
   360 0000022D EA007C0000               jmp 0:0x7c00
   361                                  
   362                                  
   363                                  
   364                                  int7:
   365                                  
   366                                  
   367 00000232 1E                       push ds
   368 00000233 06                       push es
   369 00000234 50                       push ax
   370 00000235 53                       push bx
   371 00000236 55                       push bp
   372                                  
   373 00000237 0E                       push cs
   374 00000238 1F                       pop ds
   375                                  
   376 00000239 BB4000                   mov bx, 0x40
   377 0000023C 8EC3                     mov es, bx
   378                                  
   379                                  
   380                                  
   381 0000023E 26A1A600                 mov ax, [es:this_keystroke-bios_data]
   382 00000242 26C606A70000             mov byte [es:this_keystroke+1-bios_data], 0
   383                                  
   384                                   real_key:
   385                                  
   386 00000248 2EC606[8F16]00           mov byte [cs:last_key_sdl], 0
   387                                  
   388 0000024E F6C404                   test ah, 4
   389 00000251 7503E91D01               jz check_linux_bksp
   390                                  
   391 00000256 26C606170000             mov byte [es:keyflags1-bios_data], 0
   392 0000025C 26C606180000             mov byte [es:keyflags2-bios_data], 0
   393                                  
   394 00000262 2EC606[8F16]01           mov byte [cs:last_key_sdl], 1
   395                                  
   396 00000268 F6C440                   test ah, 0x40
   397 0000026B 7406                     jz sdl_check_specials
   398                                  
   399 0000026D 2EC606[8F16]02           mov byte [cs:last_key_sdl], 2
   400                                  
   401                                   sdl_check_specials:
   402                                  
   403 00000273 89C3                     mov bx, ax
   404 00000275 80E707                   and bh, 7
   405 00000278 81FB2F05                 cmp bx, 0x52f
   406 0000027C 7420                     je sdl_just_press_shift
   407 0000027E 81FB3005                 cmp bx, 0x530
   408 00000282 741A                     je sdl_just_press_shift
   409 00000284 81FB3305                 cmp bx, 0x533
   410 00000288 7423                     je sdl_just_press_alt
   411 0000028A 81FB3405                 cmp bx, 0x534
   412 0000028E 741D                     je sdl_just_press_alt
   413 00000290 81FB3105                 cmp bx, 0x531
   414 00000294 7426                     je sdl_just_press_ctrl
   415 00000296 81FB3205                 cmp bx, 0x532
   416 0000029A 7420                     je sdl_just_press_ctrl
   417 0000029C EB2D                     jmp sdl_check_alt
   418                                  
   419                                   sdl_just_press_shift:
   420                                  
   421 0000029E B036                     mov al, 0x36
   422 000002A0 80E440                   and ah, 0x40
   423 000002A3 00E0                     add al, ah
   424 000002A5 00E0                     add al, ah
   425 000002A7 E8940E                   call io_key_available
   426 000002AA E98A02                   jmp i2_dne
   427                                  
   428                                   sdl_just_press_alt:
   429                                  
   430 000002AD B038                     mov al, 0x38
   431 000002AF 80E440                   and ah, 0x40
   432 000002B2 00E0                     add al, ah
   433 000002B4 00E0                     add al, ah
   434 000002B6 E8850E                   call io_key_available
   435 000002B9 E97B02                   jmp i2_dne
   436                                  
   437                                   sdl_just_press_ctrl:
   438                                  
   439 000002BC B01D                     mov al, 0x1d
   440 000002BE 80E440                   and ah, 0x40
   441 000002C1 00E0                     add al, ah
   442 000002C3 00E0                     add al, ah
   443 000002C5 E8760E                   call io_key_available
   444 000002C8 E96C02                   jmp i2_dne
   445                                  
   446                                   sdl_check_alt:
   447                                  
   448 000002CB F6C408                   test ah, 8
   449 000002CE 740C                     jz sdl_no_alt
   450 000002D0 268006170008             add byte [es:keyflags1-bios_data], 8
   451 000002D6 268006180002             add byte [es:keyflags2-bios_data], 2
   452                                  
   453                                   sdl_no_alt:
   454                                  
   455 000002DC F6C420                   test ah, 0x20
   456 000002DF 7406                     jz sdl_no_ctrl
   457 000002E1 268006170004             add byte [es:keyflags1-bios_data], 4
   458                                  
   459                                   sdl_no_ctrl:
   460                                  
   461 000002E7 F6C410                   test ah, 0x10
   462 000002EA 7406                     jz sdl_no_mods
   463 000002EC 268006170001             add byte [es:keyflags1-bios_data], 1
   464                                  
   465                                   sdl_no_mods:
   466                                  
   467 000002F2 80E401                   and ah, 1
   468                                  
   469                                  
   470                                  
   471                                  
   472                                  
   473                                  
   474                                   check_sdl_f_keys:
   475                                  
   476 000002F5 3D2501                   cmp ax, 0x125
   477 000002F8 7603E93A02               ja i2_dne
   478                                  
   479 000002FD 3D1A01                   cmp ax, 0x11a
   480 00000300 7211                     jb check_sdl_pgup_pgdn_keys
   481                                  
   482 00000302 2DDF00                   sub ax, 0xdf
   483 00000305 83F845                   cmp ax, 0x45
   484 00000308 7203                     jb check_sdl_f_keys2
   485 0000030A 83C012                   add ax, 0x12
   486                                  
   487                                   check_sdl_f_keys2:
   488                                  
   489 0000030D 88C7                     mov bh, al
   490 0000030F B000                     mov al, 0
   491 00000311 EB46                     jmp sdl_scancode_xlat_done
   492                                  
   493                                   check_sdl_pgup_pgdn_keys:
   494                                  
   495 00000313 3D1601                   cmp ax, 0x116
   496 00000316 7213                     jb check_sdl_cursor_keys
   497 00000318 3D1901                   cmp ax, 0x119
   498 0000031B 770E                     ja check_sdl_cursor_keys
   499                                  
   500 0000031D 2D1601                   sub ax, 0x116
   501 00000320 BB[8116]                 mov bx, pgup_pgdn_xlt
   502 00000323 2ED7                     cs xlat
   503                                  
   504 00000325 88C7                     mov bh, al
   505 00000327 B000                     mov al, 0
   506 00000329 EB2E                     jmp sdl_scancode_xlat_done
   507                                  
   508                                   check_sdl_cursor_keys:
   509                                  
   510 0000032B 3D1101                   cmp ax, 0x111
   511 0000032E 7213                     jb sdl_process_key
   512                                  
   513 00000330 2D1101                   sub ax, 0x111
   514 00000333 BB[7D16]                 mov bx, unix_cursor_xlt
   515 00000336 D7                       xlat
   516                                  
   517 00000337 88C7                     mov bh, al
   518 00000339 B000                     mov al, 0
   519 0000033B 26C606A60000             mov byte [es:this_keystroke-bios_data], 0
   520 00000341 EB16                     jmp sdl_scancode_xlat_done
   521                                  
   522                                   sdl_process_key:
   523                                  
   524 00000343 3D0001                   cmp ax, 0x100
   525 00000346 7203E9EC01               jae i2_dne
   526 0000034B 3C7F                     cmp al, 0x7f
   527 0000034D 7502                     jne sdl_process_key2
   528 0000034F B008                     mov al, 8
   529                                  
   530                                   sdl_process_key2:
   531                                  
   532 00000351 50                       push ax
   533 00000352 BB[D914]                 mov bx, a2scan_tbl
   534 00000355 D7                       xlat
   535 00000356 88C7                     mov bh, al
   536 00000358 58                       pop ax
   537                                  
   538                                   sdl_scancode_xlat_done:
   539                                  
   540 00000359 80C780                   add bh, 0x80
   541 0000035C 2E803E[8F16]02           cmp byte [cs:last_key_sdl], 2
   542 00000362 7407                     je sdl_not_in_buf
   543                                  
   544 00000364 80EF80                   sub bh, 0x80
   545                                  
   546                                   sdl_key_down:
   547                                  
   548 00000367 26A2A600                 mov [es:this_keystroke-bios_data], al
   549                                  
   550                                   sdl_not_in_buf:
   551                                  
   552 0000036B 88F8                     mov al, bh
   553 0000036D E8CE0D                   call io_key_available
   554 00000370 E9C401                   jmp i2_dne
   555                                  
   556                                   check_linux_bksp:
   557                                  
   558 00000373 3C00                     cmp al, 0
   559 00000375 7503E9BD01               je i2_dne
   560                                  
   561 0000037A 3C7F                     cmp al, 0x7f
   562 0000037C 7508                     jne after_check_bksp
   563                                  
   564 0000037E B008                     mov al, 8
   565 00000380 26C606A60008             mov byte [es:this_keystroke-bios_data], 8
   566                                  
   567                                   after_check_bksp:
   568                                  
   569 00000386 26803EA00001             cmp byte [es:next_key_fn-bios_data], 1
   570 0000038C 7503E92801               je i2_n
   571                                  
   572 00000391 3C01                     cmp al, 0x01
   573 00000393 751A                     jne i2_not_alt
   574                                  
   575 00000395 26C606170008             mov byte [es:keyflags1-bios_data], 8
   576 0000039B 26C606180002             mov byte [es:keyflags2-bios_data], 2
   577 000003A1 B038                     mov al, 0x38
   578 000003A3 E8980D                   call io_key_available
   579                                  
   580 000003A6 26C606A30001             mov byte [es:next_key_alt-bios_data], 1
   581 000003AC E98801                   jmp i2_dne
   582                                  
   583                                   i2_not_alt:
   584                                  
   585 000003AF 3C06                     cmp al, 0x06
   586 000003B1 7509                     jne i2_not_fn
   587                                  
   588 000003B3 26C606A00001             mov byte [es:next_key_fn-bios_data], 1
   589 000003B9 E97B01                   jmp i2_dne
   590                                  
   591                                   i2_not_fn:
   592                                  
   593 000003BC 26803EA50001             cmp byte [es:notranslate_flg-bios_data], 1
   594 000003C2 26C606A50000             mov byte [es:notranslate_flg-bios_data], 0
   595 000003C8 7509                     jne need_to_translate
   596                                  
   597 000003CA 26C606A60000             mov byte [es:this_keystroke-bios_data], 0
   598 000003D0 E90E01                   jmp after_translate
   599                                  
   600                                   need_to_translate:
   601                                  
   602 000003D3 3CE0                     cmp al, 0xe0
   603 000003D5 26C606A50001             mov byte [es:notranslate_flg-bios_data], 1
   604 000003DB 7503E95701               je i2_dne
   605                                  
   606 000003E0 26C606A50000             mov byte [es:notranslate_flg-bios_data], 0
   607                                  
   608 000003E6 3C1B                     cmp al, 0x1b
   609 000003E8 751C                     jne i2_escnext
   610                                  
   611                                  
   612 000003EA 26803EA40001             cmp byte [es:escape_flag-bios_data], 1
   613 000003F0 750B                     jne i2_sf
   614                                  
   615                                  
   616                                  
   617 000003F2 26C606A6001B             mov byte [es:this_keystroke-bios_data], 0x1b
   618                                  
   619 000003F8 B001                     mov al, 0x01
   620 000003FA E8240D                   call keypress_release
   621                                  
   622                                   i2_sf:
   623                                  
   624 000003FD 26C606A40001             mov byte [es:escape_flag-bios_data], 1
   625 00000403 E93101                   jmp i2_dne
   626                                  
   627                                   i2_escnext:
   628                                  
   629                                  
   630 00000406 26803EA40001             cmp byte [es:escape_flag-bios_data], 1
   631 0000040C 7524                     jne i2_noesc
   632                                  
   633                                  
   634 0000040E 3C5B                     cmp al, '['
   635 00000410 7417                     je i2_esc
   636                                  
   637                                  
   638                                  
   639 00000412 26C606A6001B             mov byte [es:this_keystroke-bios_data], 0x1b
   640                                  
   641 00000418 B001                     mov al, 0x01
   642 0000041A E8040D                   call keypress_release
   643                                  
   644                                  
   645 0000041D 26C606A40000             mov byte [es:escape_flag-bios_data], 0
   646 00000423 26A0A600                 mov al, [es:this_keystroke-bios_data]
   647 00000427 EB09                     jmp i2_noesc
   648                                  
   649                                   i2_esc:
   650                                  
   651                                  
   652 00000429 26C606A40002             mov byte [es:escape_flag-bios_data], 2
   653 0000042F E90501                   jmp i2_dne
   654                                  
   655                                   i2_noesc:
   656                                  
   657 00000432 26803EA40002             cmp byte [es:escape_flag-bios_data], 2
   658 00000438 751B                     jne i2_regular_key
   659                                  
   660                                  
   661 0000043A 26C606170000             mov byte [es:keyflags1-bios_data], 0
   662 00000440 26C606180000             mov byte [es:keyflags2-bios_data], 0
   663                                  
   664                                  
   665 00000446 2C41                     sub al, 'A'
   666 00000448 BB[7D16]                 mov bx, unix_cursor_xlt
   667 0000044B D7                       xlat
   668                                  
   669 0000044C 26C606A60000             mov byte [es:this_keystroke-bios_data], 0
   670 00000452 E98C00                   jmp after_translate
   671                                  
   672                                   i2_regular_key:
   673                                  
   674 00000455 26C606A50000             mov byte [es:notranslate_flg-bios_data], 0
   675                                  
   676 0000045B BB[5915]                 mov bx, a2shift_tbl
   677 0000045E D7                       xlat
   678                                  
   679                                  
   680                                  
   681                                  
   682 0000045F 50                       push ax
   683                                  
   684                                  
   685 00000460 268A26A300               mov ah, [es:next_key_alt-bios_data]
   686                                  [cpu 186]
   687 00000465 C0E403                   shl ah, 3
   688                                  [cpu 8086]
   689 00000468 00E0                     add al, ah
   690                                  
   691 0000046A 26803EA6001A             cmp byte [es:this_keystroke-bios_data], 0x1A
   692 00000470 7731                     ja i2_no_ctrl
   693 00000472 26803EA60000             cmp byte [es:this_keystroke-bios_data], 0
   694 00000478 7429                     je i2_no_ctrl
   695 0000047A 26803EA6000D             cmp byte [es:this_keystroke-bios_data], 0xD
   696 00000480 7421                     je i2_no_ctrl
   697 00000482 26803EA6000A             cmp byte [es:this_keystroke-bios_data], 0xA
   698 00000488 7419                     je i2_no_ctrl
   699 0000048A 26803EA60008             cmp byte [es:this_keystroke-bios_data], 0x8
   700 00000490 7411                     je i2_no_ctrl
   701 00000492 26803EA60009             cmp byte [es:this_keystroke-bios_data], 0x9
   702 00000498 7409                     je i2_no_ctrl
   703 0000049A 0404                     add al, 4
   704                                  
   705 0000049C 50                       push ax
   706 0000049D B01D                     mov al, 0x1d
   707 0000049F E89C0C                   call io_key_available
   708 000004A2 58                       pop ax
   709                                  
   710                                   i2_no_ctrl:
   711                                  
   712 000004A3 26A21700                 mov [es:keyflags1-bios_data], al
   713                                  
   714                                  [cpu 186]
   715 000004A7 C0EC02                   shr ah, 2
   716                                  [cpu 8086]
   717 000004AA 2688261800               mov [es:keyflags2-bios_data], ah
   718                                  
   719 000004AF 58                       pop ax
   720                                  
   721 000004B0 A801                     test al, 1
   722 000004B2 7405                     jz i2_n
   723                                  
   724 000004B4 B036                     mov al, 0x36
   725 000004B6 E8850C                   call io_key_available
   726                                  
   727                                   i2_n:
   728                                  
   729 000004B9 26A0A600                 mov al, [es:this_keystroke-bios_data]
   730                                  
   731 000004BD BB[D914]                 mov bx, a2scan_tbl
   732 000004C0 D7                       xlat
   733                                  
   734 000004C1 26803EA00001             cmp byte [es:next_key_fn-bios_data], 1
   735 000004C7 7518                     jne after_translate
   736                                  
   737 000004C9 26803EA60001             cmp byte [es:this_keystroke-bios_data], 1
   738 000004CF 7410                     je after_translate
   739                                  
   740 000004D1 26803EA60006             cmp byte [es:this_keystroke-bios_data], 6
   741 000004D7 7408                     je after_translate
   742                                  
   743 000004D9 26C606A60000             mov byte [es:this_keystroke-bios_data], 0
   744 000004DF 0439                     add al, 0x39
   745                                  
   746                                   after_translate:
   747                                  
   748 000004E1 26C606A40000             mov byte [es:escape_flag-bios_data], 0
   749 000004E7 26C606A20000             mov byte [es:escape_flag_last-bios_data], 0
   750                                  
   751                                  
   752                                  
   753 000004ED 26803EA30001             cmp byte [es:next_key_alt-bios_data], 1
   754 000004F3 7506                     jne skip_ascii_zero
   755                                  
   756 000004F5 26C606A60000             mov byte [es:this_keystroke-bios_data], 0
   757                                  
   758                                   skip_ascii_zero:
   759                                  
   760                                  
   761 000004FB E8230C                   call keypress_release
   762                                  
   763                                  
   764 000004FE 3CE0                     cmp al, 0xe0
   765 00000500 7435                     je i2_dne
   766                                  
   767 00000502 26F606170001             test byte [es:keyflags1-bios_data], 1
   768 00000508 7405                     jz check_ctrl
   769                                  
   770 0000050A B0B6                     mov al, 0xb6
   771 0000050C E82F0C                   call io_key_available
   772                                  
   773                                   check_ctrl:
   774                                  
   775 0000050F 26F606170004             test byte [es:keyflags1-bios_data], 4
   776 00000515 7405                     jz check_alt
   777                                  
   778 00000517 B09D                     mov al, 0x9d
   779 00000519 E8220C                   call io_key_available
   780                                  
   781                                   check_alt:
   782                                  
   783 0000051C 26A0A300                 mov al, byte [es:next_key_alt-bios_data]
   784 00000520 26C606A30000             mov byte [es:next_key_alt-bios_data], 0
   785 00000526 26C606A00000             mov byte [es:next_key_fn-bios_data], 0
   786                                  
   787 0000052C 3C01                     cmp al, 1
   788 0000052E 7402                     je endalt
   789                                  
   790 00000530 EB05                     jmp i2_dne
   791                                  
   792                                   endalt:
   793                                  
   794 00000532 B0B8                     mov al, 0xb8
   795 00000534 E8070C                   call io_key_available
   796                                  
   797                                   i2_dne:
   798                                  
   799 00000537 5D                       pop bp
   800 00000538 5B                       pop bx
   801 00000539 58                       pop ax
   802 0000053A 07                       pop es
   803 0000053B 1F                       pop ds
   804 0000053C CF                       iret
   805                                  
   806                                  
   807                                  
   808                                  int9:
   809                                  
   810 0000053D 06                       push es
   811 0000053E 50                       push ax
   812 0000053F 53                       push bx
   813 00000540 55                       push bp
   814                                  
   815 00000541 E460                     in al, 0x60
   816                                  
   817 00000543 3C80                     cmp al, 0x80
   818 00000545 732D                     jae no_add_buf
   819 00000547 3C36                     cmp al, 0x36
   820 00000549 7429                     je no_add_buf
   821 0000054B 3C38                     cmp al, 0x38
   822 0000054D 7425                     je no_add_buf
   823 0000054F 3C1D                     cmp al, 0x1d
   824 00000551 7421                     je no_add_buf
   825                                  
   826 00000553 BB4000                   mov bx, 0x40
   827 00000556 8EC3                     mov es, bx
   828                                  
   829 00000558 88C7                     mov bh, al
   830 0000055A 26A0A600                 mov al, [es:this_keystroke-bios_data]
   831                                  
   832                                  
   833                                  
   834 0000055E 268B2E1C00               mov bp, [es:kbbuf_tail-bios_data]
   835 00000563 26884600                 mov byte [es:bp], al
   836 00000567 26887E01                 mov byte [es:bp+1], bh
   837                                  
   838                                  
   839 0000056B 2683061C0002             add word [es:kbbuf_tail-bios_data], 2
   840 00000571 E8470A                   call kb_adjust_buf
   841                                  
   842                                   no_add_buf:
   843                                  
   844 00000574 B001                     mov al, 1
   845 00000576 E664                     out 0x64, al
   846                                  
   847 00000578 5D                       pop bp
   848 00000579 5B                       pop bx
   849 0000057A 58                       pop ax
   850 0000057B 07                       pop es
   851                                  
   852 0000057C CF                       iret
   853                                  
   854                                  
   855                                  
   856                                  inta:
   857                                  
   858                                  
   859                                  
   860                                  
   861                                  
   862                                  
   863                                  
   864                                  
   865 0000057D 50                       push ax
   866 0000057E 53                       push bx
   867 0000057F 52                       push dx
   868 00000580 55                       push bp
   869 00000581 06                       push es
   870                                  
   871 00000582 51                       push cx
   872 00000583 57                       push di
   873 00000584 1E                       push ds
   874 00000585 56                       push si
   875                                  
   876 00000586 E8D60B                   call vmem_driver_entry
   877                                  
   878                                  
   879                                  
   880 00000589 0E                       push cs
   881 0000058A 07                       pop es
   882 0000058B BB[F11D]                 mov bx, timetable
   883                                  %line 19+1 bios.asm
    20 0000058E 0F01                     db 0x0f, 0x01
    21                                  %line 883+1 bios.asm
   884                                  
   885 00000590 2EA1[151E]               mov ax, [cs:tm_msec]
   886 00000594 2E2B06[8D16]             sub ax, [cs:last_int8_msec]
   887                                  
   888                                   make_ctr_positive:
   889                                  
   890 00000599 83F800                   cmp ax, 0
   891 0000059C 7D05                     jge no_add_1000
   892                                  
   893 0000059E 05E803                   add ax, 1000
   894 000005A1 EBF6                     jmp make_ctr_positive
   895                                  
   896                                   no_add_1000:
   897                                  
   898 000005A3 BB4000                   mov bx, 0x40
   899 000005A6 8EC3                     mov es, bx
   900                                  
   901 000005A8 BA0000                   mov dx, 0
   902 000005AB BBA904                   mov bx, 1193
   903 000005AE F7E3                     mul bx
   904                                  
   905 000005B0 268B1EA800               mov bx, [es:timer0_freq-bios_data]
   906                                  
   907 000005B5 83FB00                   cmp bx, 0
   908 000005B8 7503                     jne no_adjust_10000
   909                                  
   910 000005BA BBFFFF                   mov bx, 0xffff
   911                                  
   912                                   no_adjust_10000:
   913                                  
   914 000005BD F7F3                     div bx
   915                                  
   916 000005BF 83F800                   cmp ax, 0
   917 000005C2 746A                     je i8_end
   918                                  
   919 000005C4 2601066C00               add word [es:0x6C], ax
   920 000005C9 2683166E0000             adc word [es:0x6E], 0
   921                                  
   922                                  inta_call_int8:
   923                                  
   924 000005CF 50                       push ax
   925 000005D0 CD08                     int 8
   926 000005D2 58                       pop ax
   927                                  
   928 000005D3 48                       dec ax
   929 000005D4 83F800                   cmp ax, 0
   930 000005D7 75F6                     jne inta_call_int8
   931                                  
   932 000005D9 2EA1[151E]               mov ax, [cs:tm_msec]
   933 000005DD 2EA3[8D16]               mov [cs:last_int8_msec], ax
   934                                  
   935                                  skip_timer_increment:
   936                                  
   937                                  
   938 000005E1 2E803E[8F16]00           cmp byte [cs:last_key_sdl], 0
   939 000005E7 7545                     jne i8_end
   940                                  
   941                                  
   942 000005E9 26803E9F0000             cmp byte [es:key_now_down-bios_data], 0
   943 000005EF 740F                     je i8_no_key_down
   944                                  
   945 000005F1 26A09F00                 mov al, [es:key_now_down-bios_data]
   946 000005F5 26C6069F0000             mov byte [es:key_now_down-bios_data], 0
   947 000005FB 0480                     add al, 0x80
   948 000005FD E83E0B                   call io_key_available
   949                                  
   950                                   i8_no_key_down:
   951                                  
   952                                  
   953 00000600 26803EA40001             cmp byte [es:escape_flag-bios_data], 1
   954 00000606 7526                     jne i8_end
   955                                  
   956                                  
   957 00000608 26803EA20001             cmp byte [es:escape_flag_last-bios_data], 1
   958 0000060E 7407                     je i8_stuff_esc
   959                                  
   960 00000610 26FE06A200               inc byte [es:escape_flag_last-bios_data]
   961 00000615 EB17                     jmp i8_end
   962                                  
   963                                  i8_stuff_esc:
   964                                  
   965                                  
   966 00000617 26C606A40000             mov byte [es:escape_flag-bios_data], 0
   967 0000061D 26C606A20000             mov byte [es:escape_flag_last-bios_data], 0
   968                                  
   969                                  
   970                                  
   971                                  
   972                                  
   973                                  
   974                                  
   975                                  
   976                                  
   977 00000623 26C606A6001B             mov byte [es:this_keystroke-bios_data], 0x1b
   978                                  
   979                                  
   980 00000629 B001                     mov al, 0x01
   981 0000062B E8F30A                   call keypress_release
   982                                  
   983                                  i8_end:
   984                                  
   985                                  
   986 0000062E BABA03                   mov dx, 0x3BA
   987 00000631 EC                       in al, dx
   988 00000632 3480                     xor al, 0x80
   989 00000634 EE                       out dx, al
   990                                  
   991 00000635 5E                       pop si
   992 00000636 1F                       pop ds
   993 00000637 5F                       pop di
   994 00000638 59                       pop cx
   995                                  
   996 00000639 07                       pop es
   997 0000063A 5D                       pop bp
   998 0000063B 5A                       pop dx
   999 0000063C 5B                       pop bx
  1000 0000063D 58                       pop ax
  1001                                  
  1002 0000063E CF                       iret
  1003                                  
  1004                                  
  1005                                  
  1006                                  int8:
  1007                                  
  1008 0000063F CD1C                     int 0x1c
  1009 00000641 CF                       iret
  1010                                  
  1011                                  
  1012                                  
  1013                                  int10:
  1014                                  
  1015 00000642 80FC00                   cmp ah, 0x00
  1016 00000645 7449                     je int10_set_vm
  1017 00000647 80FC01                   cmp ah, 0x01
  1018 0000064A 7503E9E800               je int10_set_cshape
  1019 0000064F 80FC02                   cmp ah, 0x02
  1020 00000652 7503E90601               je int10_set_cursor
  1021 00000657 80FC03                   cmp ah, 0x03
  1022 0000065A 7503E95401               je int10_get_cursor
  1023 0000065F 80FC06                   cmp ah, 0x06
  1024 00000662 7503E96101               je int10_scrollup
  1025 00000667 80FC07                   cmp ah, 0x07
  1026 0000066A 7503E97B02               je int10_scrolldown
  1027 0000066F 80FC08                   cmp ah, 0x08
  1028 00000672 7503E99603               je int10_charatcur
  1029 00000677 80FC09                   cmp ah, 0x09
  1030 0000067A 7503E9F703               je int10_write_char_attrib
  1031 0000067F 80FC0E                   cmp ah, 0x0e
  1032 00000682 7503E9B803               je int10_write_char
  1033 00000687 80FC0F                   cmp ah, 0x0f
  1034 0000068A 7503E90705               je int10_get_vm
  1035                                  
  1036                                  
  1037                                  
  1038 0000068F CF                       iret
  1039                                  
  1040                                   int10_set_vm:
  1041                                  
  1042 00000690 52                       push dx
  1043 00000691 51                       push cx
  1044 00000692 53                       push bx
  1045 00000693 06                       push es
  1046                                  
  1047 00000694 3C04                     cmp al, 4
  1048 00000696 743D                     je int10_switch_to_cga_gfx
  1049 00000698 3C05                     cmp al, 5
  1050 0000069A 7439                     je int10_switch_to_cga_gfx
  1051 0000069C 3C06                     cmp al, 6
  1052 0000069E 7435                     je int10_switch_to_cga_gfx
  1053                                  
  1054 000006A0 50                       push ax
  1055                                  
  1056 000006A1 BAB803                   mov dx, 0x3b8
  1057 000006A4 B000                     mov al, 0
  1058 000006A6 EE                       out dx, al
  1059                                  
  1060 000006A7 BAB403                   mov dx, 0x3b4
  1061 000006AA B001                     mov al, 1
  1062 000006AC EE                       out dx, al
  1063 000006AD BAB503                   mov dx, 0x3b5
  1064 000006B0 B02D                     mov al, 0x2d
  1065 000006B2 EE                       out dx, al
  1066 000006B3 BAB403                   mov dx, 0x3b4
  1067 000006B6 B006                     mov al, 6
  1068 000006B8 EE                       out dx, al
  1069 000006B9 BAB503                   mov dx, 0x3b5
  1070 000006BC B057                     mov al, 0x57
  1071 000006BE EE                       out dx, al
  1072                                  
  1073 000006BF BA4000                   mov dx, 0x40
  1074 000006C2 8EC2                     mov es, dx
  1075                                  
  1076 000006C4 26C606AC0000             mov byte [es:0xac], 0
  1077                                  
  1078 000006CA 58                       pop ax
  1079                                  
  1080 000006CB 3C07                     cmp al, 7
  1081 000006CD 743D                     je int10_set_vm_3
  1082 000006CF 3C02                     cmp al, 2
  1083 000006D1 7439                     je int10_set_vm_3
  1084                                  
  1085 000006D3 EB39                     jmp int10_set_vm_continue
  1086                                  
  1087                                   int10_switch_to_cga_gfx:
  1088                                  
  1089                                  
  1090                                  
  1091 000006D5 BA4000                   mov dx, 0x40
  1092 000006D8 8EC2                     mov es, dx
  1093                                  
  1094 000006DA 26A24900                 mov [es:0x49], al
  1095 000006DE 26C606AC0001             mov byte [es:0xac], 1
  1096                                  
  1097 000006E4 BAB403                   mov dx, 0x3b4
  1098 000006E7 B001                     mov al, 1
  1099 000006E9 EE                       out dx, al
  1100 000006EA BAB503                   mov dx, 0x3b5
  1101 000006ED B028                     mov al, 0x28
  1102 000006EF EE                       out dx, al
  1103 000006F0 BAB403                   mov dx, 0x3b4
  1104 000006F3 B006                     mov al, 6
  1105 000006F5 EE                       out dx, al
  1106 000006F6 BAB503                   mov dx, 0x3b5
  1107 000006F9 B064                     mov al, 0x64
  1108 000006FB EE                       out dx, al
  1109                                  
  1110 000006FC BAB803                   mov dx, 0x3b8
  1111 000006FF B08A                     mov al, 0x8a
  1112 00000701 EE                       out dx, al
  1113                                  
  1114 00000702 B707                     mov bh, 7
  1115 00000704 E85009                   call clear_screen
  1116                                  
  1117 00000707 B83000                   mov ax, 0x30
  1118 0000070A EB26                     jmp svmn_exit
  1119                                  
  1120                                   int10_set_vm_3:
  1121                                  
  1122 0000070C B003                     mov al, 3
  1123                                  
  1124                                   int10_set_vm_continue:
  1125                                  
  1126 0000070E BB4000                   mov bx, 0x40
  1127 00000711 8EC3                     mov es, bx
  1128                                  
  1129 00000713 26A24900                 mov [es:vidmode-bios_data], al
  1130                                  
  1131 00000717 B707                     mov bh, 7
  1132 00000719 E83B09                   call clear_screen
  1133                                  
  1134 0000071C 26803E490006             cmp byte [es:vidmode-bios_data], 6
  1135 00000722 7404                     je set6
  1136 00000724 B030                     mov al, 0x30
  1137 00000726 EB02                     jmp svmn
  1138                                  
  1139                                   set6:
  1140                                  
  1141 00000728 B03F                     mov al, 0x3f
  1142                                  
  1143                                   svmn:
  1144                                  
  1145                                  
  1146 0000072A 50                       push ax
  1147 0000072B BAB803                   mov dx, 0x3B8
  1148 0000072E B000                     mov al, 0
  1149 00000730 EE                       out dx, al
  1150 00000731 58                       pop ax
  1151                                  
  1152                                   svmn_exit:
  1153                                  
  1154 00000732 07                       pop es
  1155 00000733 5B                       pop bx
  1156 00000734 59                       pop cx
  1157 00000735 5A                       pop dx
  1158 00000736 CF                       iret
  1159                                  
  1160                                   int10_set_cshape:
  1161                                  
  1162 00000737 1E                       push ds
  1163 00000738 50                       push ax
  1164 00000739 51                       push cx
  1165                                  
  1166 0000073A B84000                   mov ax, 0x40
  1167 0000073D 8ED8                     mov ds, ax
  1168                                  
  1169 0000073F C606A10001               mov byte [cursor_visible-bios_data], 1
  1170                                  
  1171 00000744 80E560                   and ch, 01100000b
  1172 00000747 80FD20                   cmp ch, 00100000b
  1173 0000074A 750A                     jne cur_visible
  1174                                  
  1175 0000074C C606A10000               mov byte [cursor_visible-bios_data], 0
  1176 00000751 E86D0C                   call ansi_hide_cursor
  1177 00000754 EB03                     jmp cur_done
  1178                                  
  1179                                   cur_visible:
  1180                                  
  1181 00000756 E84F0C                   call ansi_show_cursor
  1182                                  
  1183                                   cur_done:
  1184                                  
  1185 00000759 59                       pop cx
  1186 0000075A 58                       pop ax
  1187 0000075B 1F                       pop ds
  1188 0000075C CF                       iret
  1189                                  
  1190                                   int10_set_cursor:
  1191                                  
  1192 0000075D 1E                       push ds
  1193 0000075E 50                       push ax
  1194                                  
  1195 0000075F B84000                   mov ax, 0x40
  1196 00000762 8ED8                     mov ds, ax
  1197                                  
  1198 00000764 88365100                 mov [curpos_y-bios_data], dh
  1199 00000768 88369E00                 mov [crt_curpos_y-bios_data], dh
  1200 0000076C 88165000                 mov [curpos_x-bios_data], dl
  1201 00000770 88169D00                 mov [crt_curpos_x-bios_data], dl
  1202                                  
  1203 00000774 80FE18                   cmp dh, 24
  1204 00000777 7605                     jbe skip_set_cur_row_max
  1205                                  
  1206                                  
  1207 00000779 E8450C                   call ansi_hide_cursor
  1208 0000077C EB32                     jmp skip_set_cur_ansi
  1209                                  
  1210                                   skip_set_cur_row_max:
  1211                                  
  1212 0000077E 80FA4F                   cmp dl, 79
  1213 00000781 7605                     jbe skip_set_cur_col_max
  1214                                  
  1215                                  
  1216 00000783 E83B0C                   call ansi_hide_cursor
  1217 00000786 EB28                     jmp skip_set_cur_ansi
  1218                                  
  1219                                   skip_set_cur_col_max:
  1220                                  
  1221 00000788 B01B                     mov al, 0x1B
  1222                                  %line 15+1 bios.asm
    16 0000078A 0F00                     db 0x0f, 0x00
    17                                  %line 1222+1 bios.asm
  1223 0000078C B05B                     mov al, '['
  1224                                  %line 15+1 bios.asm
    16 0000078E 0F00                     db 0x0f, 0x00
    17                                  %line 1224+1 bios.asm
  1225 00000790 88F0                     mov al, dh
  1226 00000792 FEC0                     inc al
  1227 00000794 E80F08                   call puts_decimal_al
  1228 00000797 B03B                     mov al, ';'
  1229                                  %line 15+1 bios.asm
    16 00000799 0F00                     db 0x0f, 0x00
    17                                  %line 1229+1 bios.asm
  1230 0000079B 88D0                     mov al, dl
  1231 0000079D FEC0                     inc al
  1232 0000079F E80408                   call puts_decimal_al
  1233 000007A2 B048                     mov al, 'H'
  1234                                  %line 15+1 bios.asm
    16 000007A4 0F00                     db 0x0f, 0x00
    17                                  %line 1234+1 bios.asm
  1235                                  
  1236 000007A6 803EA10001               cmp byte [cursor_visible-bios_data], 1
  1237 000007AB 7503                     jne skip_set_cur_ansi
  1238 000007AD E8F80B                   call ansi_show_cursor
  1239                                  
  1240                                   skip_set_cur_ansi:
  1241                                  
  1242 000007B0 58                       pop ax
  1243 000007B1 1F                       pop ds
  1244 000007B2 CF                       iret
  1245                                  
  1246                                   int10_get_cursor:
  1247                                  
  1248 000007B3 06                       push es
  1249                                  
  1250 000007B4 B94000                   mov cx, 0x40
  1251 000007B7 8EC1                     mov es, cx
  1252                                  
  1253 000007B9 B90706                   mov cx, 0x0607
  1254 000007BC 268A165000               mov dl, [es:curpos_x-bios_data]
  1255 000007C1 268A365100               mov dh, [es:curpos_y-bios_data]
  1256                                  
  1257 000007C6 07                       pop es
  1258                                  
  1259 000007C7 CF                       iret
  1260                                  
  1261                                   int10_scrollup:
  1262                                  
  1263 000007C8 53                       push bx
  1264 000007C9 51                       push cx
  1265 000007CA 55                       push bp
  1266 000007CB 50                       push ax
  1267                                  
  1268 000007CC 89DD                     mov bp, bx
  1269 000007CE B10C                     mov cl, 12
  1270 000007D0 D3CD                     ror bp, cl
  1271 000007D2 83E507                   and bp, 7
  1272 000007D5 2E8A9E[5516]             mov bl, byte [cs:bp+colour_table]
  1273 000007DA 80C30A                   add bl, 10
  1274                                  
  1275 000007DD B01B                     mov al, 0x1B
  1276                                  %line 15+1 bios.asm
    16 000007DF 0F00                     db 0x0f, 0x00
    17                                  %line 1276+1 bios.asm
  1277 000007E1 B05B                     mov al, '['
  1278                                  %line 15+1 bios.asm
    16 000007E3 0F00                     db 0x0f, 0x00
    17                                  %line 1278+1 bios.asm
  1279 000007E5 88D8                     mov al, bl
  1280 000007E7 E8BC07                   call puts_decimal_al
  1281 000007EA B06D                     mov al, 'm'
  1282                                  %line 15+1 bios.asm
    16 000007EC 0F00                     db 0x0f, 0x00
    17                                  %line 1282+1 bios.asm
  1283                                  
  1284 000007EE 58                       pop ax
  1285 000007EF 5D                       pop bp
  1286 000007F0 59                       pop cx
  1287 000007F1 5B                       pop bx
  1288                                  
  1289 000007F2 3C00                     cmp al, 0
  1290 000007F4 7513                     jne cls_partial
  1291                                  
  1292 000007F6 83F900                   cmp cx, 0
  1293 000007F9 750E                     jne cls_partial
  1294                                  
  1295 000007FB 80FA4F                   cmp dl, 0x4f
  1296 000007FE 7209                     jb cls_partial
  1297                                  
  1298 00000800 80FE18                   cmp dh, 0x18
  1299 00000803 7204                     jb cls_partial
  1300                                  
  1301 00000805 E84F08                   call clear_screen
  1302 00000808 CF                       iret
  1303                                  
  1304                                   cls_partial:
  1305                                  
  1306 00000809 50                       push ax
  1307 0000080A 53                       push bx
  1308                                  
  1309 0000080B 88C3                     mov bl, al
  1310 0000080D 80FB00                   cmp bl, 0
  1311 00000810 7502                     jne cls_partial_up_whole
  1312                                  
  1313 00000812 B319                     mov bl, 25
  1314                                  
  1315                                   cls_partial_up_whole:
  1316                                  
  1317 00000814 B01B                     mov al, 0x1B
  1318                                  %line 15+1 bios.asm
    16 00000816 0F00                     db 0x0f, 0x00
    17                                  %line 1318+1 bios.asm
  1319 00000818 B05B                     mov al, '['
  1320                                  %line 15+1 bios.asm
    16 0000081A 0F00                     db 0x0f, 0x00
    17                                  %line 1320+1 bios.asm
  1321                                  
  1322 0000081C 80FD00                   cmp ch, 0
  1323 0000081F 7402                     je cls_maybe_fs
  1324 00000821 EB05                     jmp cls_not_fs
  1325                                  
  1326                                   cls_maybe_fs:
  1327                                  
  1328 00000823 80FE18                   cmp dh, 24
  1329 00000826 7412                     je cls_fs
  1330                                  
  1331                                   cls_not_fs:
  1332                                  
  1333 00000828 88E8                     mov al, ch
  1334 0000082A FEC0                     inc al
  1335 0000082C E87707                   call puts_decimal_al
  1336 0000082F B03B                     mov al, ';'
  1337                                  %line 15+1 bios.asm
    16 00000831 0F00                     db 0x0f, 0x00
    17                                  %line 1337+1 bios.asm
  1338 00000833 88F0                     mov al, dh
  1339 00000835 FEC0                     inc al
  1340 00000837 E86C07                   call puts_decimal_al
  1341                                  
  1342                                   cls_fs:
  1343                                  
  1344 0000083A B072                     mov al, 'r'
  1345                                  %line 15+1 bios.asm
    16 0000083C 0F00                     db 0x0f, 0x00
    17                                  %line 1345+1 bios.asm
  1346                                  
  1347 0000083E B01B                     mov al, 0x1B
  1348                                  %line 15+1 bios.asm
    16 00000840 0F00                     db 0x0f, 0x00
    17                                  %line 1348+1 bios.asm
  1349 00000842 B05B                     mov al, '['
  1350                                  %line 15+1 bios.asm
    16 00000844 0F00                     db 0x0f, 0x00
    17                                  %line 1350+1 bios.asm
  1351                                  
  1352 00000846 80FB01                   cmp bl, 1
  1353 00000849 7504                     jne cls_fs_multiline
  1354                                  
  1355 0000084B B04D                     mov al, 'M'
  1356 0000084D EB07                     jmp cs_fs_ml_out
  1357                                  
  1358                                  cls_fs_multiline:
  1359                                  
  1360 0000084F 88D8                     mov al, bl
  1361 00000851 E85207                   call puts_decimal_al
  1362 00000854 B053                     mov al, 'S'
  1363                                  
  1364                                  cs_fs_ml_out:
  1365                                  
  1366                                  %line 15+1 bios.asm
    16 00000856 0F00                     db 0x0f, 0x00
    17                                  %line 1366+1 bios.asm
  1367                                  
  1368 00000858 5B                       pop bx
  1369 00000859 58                       pop ax
  1370                                  
  1371                                  
  1372                                  
  1373                                  
  1374 0000085A 50                       push ax
  1375 0000085B 53                       push bx
  1376 0000085C 52                       push dx
  1377 0000085D 06                       push es
  1378                                  
  1379 0000085E B84000                   mov ax, 0x40
  1380 00000861 8EC0                     mov es, ax
  1381                                  
  1382 00000863 B402                     mov ah, 2
  1383 00000865 B700                     mov bh, 0
  1384 00000867 268A365100               mov dh, [es:curpos_y-bios_data]
  1385 0000086C 268A165000               mov dl, [es:curpos_x-bios_data]
  1386 00000871 CD10                     int 10h
  1387                                  
  1388 00000873 07                       pop es
  1389 00000874 5A                       pop dx
  1390 00000875 5B                       pop bx
  1391 00000876 58                       pop ax
  1392                                  
  1393                                  int10_scroll_up_vmem_update:
  1394                                  
  1395                                  
  1396                                  
  1397 00000877 53                       push bx
  1398 00000878 50                       push ax
  1399                                  
  1400 00000879 1E                       push ds
  1401 0000087A 06                       push es
  1402 0000087B 51                       push cx
  1403 0000087C 52                       push dx
  1404 0000087D 56                       push si
  1405 0000087E 57                       push di
  1406                                  
  1407 0000087F 2EC606[8716]01           mov byte [cs:vram_dirty], 1
  1408                                  
  1409 00000885 53                       push bx
  1410                                  
  1411 00000886 BB00B8                   mov bx, 0xb800
  1412 00000889 8EC3                     mov es, bx
  1413 0000088B 8EDB                     mov ds, bx
  1414                                  
  1415 0000088D 5B                       pop bx
  1416 0000088E 88C3                     mov bl, al
  1417                                  
  1418                                   cls_vmem_scroll_up_next_line:
  1419                                  
  1420 00000890 80FB00                   cmp bl, 0
  1421 00000893 744C                     je cls_vmem_scroll_up_done
  1422                                  
  1423                                   cls_vmem_scroll_up_one:
  1424                                  
  1425 00000895 53                       push bx
  1426 00000896 52                       push dx
  1427                                  
  1428 00000897 B80000                   mov ax, 0
  1429 0000089A 88E8                     mov al, ch
  1430 0000089C BB5000                   mov bx, 80
  1431 0000089F F7E3                     mul bx
  1432 000008A1 00C8                     add al, cl
  1433 000008A3 80D400                   adc ah, 0
  1434 000008A6 BB0200                   mov bx, 2
  1435 000008A9 F7E3                     mul bx
  1436                                  
  1437 000008AB 5A                       pop dx
  1438 000008AC 5B                       pop bx
  1439                                  
  1440 000008AD 89C7                     mov di, ax
  1441 000008AF 89C6                     mov si, ax
  1442 000008B1 81C6A000                 add si, 2*80
  1443                                  
  1444 000008B5 B80000                   mov ax, 0
  1445 000008B8 00D0                     add al, dl
  1446 000008BA 80D400                   adc ah, 0
  1447 000008BD 40                       inc ax
  1448 000008BE 28C8                     sub al, cl
  1449 000008C0 80DC00                   sbb ah, 0
  1450                                  
  1451 000008C3 38F5                     cmp ch, dh
  1452 000008C5 730B                     jae cls_vmem_scroll_up_one_done
  1453                                  
  1454                                  vmem_scroll_up_copy_next_row:
  1455                                  
  1456 000008C7 51                       push cx
  1457 000008C8 89C1                     mov cx, ax
  1458 000008CA FC                       cld
  1459 000008CB F3A5                     rep movsw
  1460 000008CD 59                       pop cx
  1461                                  
  1462 000008CE FEC5                     inc ch
  1463 000008D0 EBC3                     jmp cls_vmem_scroll_up_one
  1464                                  
  1465                                   cls_vmem_scroll_up_one_done:
  1466                                  
  1467 000008D2 51                       push cx
  1468 000008D3 89C1                     mov cx, ax
  1469 000008D5 88FC                     mov ah, bh
  1470 000008D7 B000                     mov al, 0
  1471 000008D9 FC                       cld
  1472 000008DA F3AB                     rep stosw
  1473 000008DC 59                       pop cx
  1474                                  
  1475 000008DD FECB                     dec bl
  1476 000008DF EBAF                     jmp cls_vmem_scroll_up_next_line
  1477                                  
  1478                                   cls_vmem_scroll_up_done:
  1479                                  
  1480                                  
  1481                                  
  1482                                  
  1483                                  
  1484                                  
  1485                                  
  1486                                  
  1487                                  
  1488                                  
  1489 000008E1 5F                       pop di
  1490 000008E2 5E                       pop si
  1491 000008E3 5A                       pop dx
  1492 000008E4 59                       pop cx
  1493 000008E5 07                       pop es
  1494 000008E6 1F                       pop ds
  1495                                  
  1496 000008E7 58                       pop ax
  1497 000008E8 5B                       pop bx
  1498                                  
  1499 000008E9 CF                       iret
  1500                                  
  1501                                   int10_scrolldown:
  1502                                  
  1503 000008EA 53                       push bx
  1504 000008EB 51                       push cx
  1505 000008EC 55                       push bp
  1506 000008ED 50                       push ax
  1507                                  
  1508 000008EE 89DD                     mov bp, bx
  1509 000008F0 B10C                     mov cl, 12
  1510 000008F2 D3CD                     ror bp, cl
  1511 000008F4 83E507                   and bp, 7
  1512 000008F7 2E8A9E[5516]             mov bl, byte [cs:bp+colour_table]
  1513 000008FC 80C30A                   add bl, 10
  1514                                  
  1515 000008FF B01B                     mov al, 0x1B
  1516                                  %line 15+1 bios.asm
    16 00000901 0F00                     db 0x0f, 0x00
    17                                  %line 1516+1 bios.asm
  1517 00000903 B05B                     mov al, '['
  1518                                  %line 15+1 bios.asm
    16 00000905 0F00                     db 0x0f, 0x00
    17                                  %line 1518+1 bios.asm
  1519 00000907 88D8                     mov al, bl
  1520 00000909 E89A06                   call puts_decimal_al
  1521 0000090C B06D                     mov al, 'm'
  1522                                  %line 15+1 bios.asm
    16 0000090E 0F00                     db 0x0f, 0x00
    17                                  %line 1522+1 bios.asm
  1523                                  
  1524 00000910 58                       pop ax
  1525 00000911 5D                       pop bp
  1526 00000912 59                       pop cx
  1527 00000913 5B                       pop bx
  1528                                  
  1529 00000914 3C00                     cmp al, 0
  1530 00000916 7513                     jne cls_partial_down
  1531                                  
  1532 00000918 83F900                   cmp cx, 0
  1533 0000091B 750E                     jne cls_partial_down
  1534                                  
  1535 0000091D 80FA4F                   cmp dl, 0x4f
  1536 00000920 7509                     jne cls_partial_down
  1537                                  
  1538 00000922 80FE18                   cmp dh, 0x18
  1539 00000925 7C04                     jl cls_partial_down
  1540                                  
  1541 00000927 E82D07                   call clear_screen
  1542 0000092A CF                       iret
  1543                                  
  1544                                   cls_partial_down:
  1545                                  
  1546 0000092B 50                       push ax
  1547 0000092C 53                       push bx
  1548                                  
  1549 0000092D BB0000                   mov bx, 0
  1550 00000930 88C3                     mov bl, al
  1551                                  
  1552 00000932 80FB00                   cmp bl, 0
  1553 00000935 7502                     jne cls_partial_down_whole
  1554                                  
  1555 00000937 B319                     mov bl, 25
  1556                                  
  1557                                   cls_partial_down_whole:
  1558                                  
  1559 00000939 B01B                     mov al, 0x1B
  1560                                  %line 15+1 bios.asm
    16 0000093B 0F00                     db 0x0f, 0x00
    17                                  %line 1560+1 bios.asm
  1561 0000093D B05B                     mov al, '['
  1562                                  %line 15+1 bios.asm
    16 0000093F 0F00                     db 0x0f, 0x00
    17                                  %line 1562+1 bios.asm
  1563                                  
  1564 00000941 80FD00                   cmp ch, 0
  1565 00000944 7402                     je cls_maybe_fs_down
  1566 00000946 EB05                     jmp cls_not_fs_down
  1567                                  
  1568                                   cls_maybe_fs_down:
  1569                                  
  1570 00000948 80FE18                   cmp dh, 24
  1571 0000094B 7412                     je cls_fs_down
  1572                                  
  1573                                   cls_not_fs_down:
  1574                                  
  1575 0000094D 88E8                     mov al, ch
  1576 0000094F FEC0                     inc al
  1577 00000951 E85206                   call puts_decimal_al
  1578 00000954 B03B                     mov al, ';'
  1579                                  %line 15+1 bios.asm
    16 00000956 0F00                     db 0x0f, 0x00
    17                                  %line 1579+1 bios.asm
  1580 00000958 88F0                     mov al, dh
  1581 0000095A FEC0                     inc al
  1582 0000095C E84706                   call puts_decimal_al
  1583                                  
  1584                                   cls_fs_down:
  1585                                  
  1586 0000095F B072                     mov al, 'r'
  1587                                  %line 15+1 bios.asm
    16 00000961 0F00                     db 0x0f, 0x00
    17                                  %line 1587+1 bios.asm
  1588                                  
  1589 00000963 B01B                     mov al, 0x1B
  1590                                  %line 15+1 bios.asm
    16 00000965 0F00                     db 0x0f, 0x00
    17                                  %line 1590+1 bios.asm
  1591 00000967 B05B                     mov al, '['
  1592                                  %line 15+1 bios.asm
    16 00000969 0F00                     db 0x0f, 0x00
    17                                  %line 1592+1 bios.asm
  1593                                  
  1594 0000096B 80FB01                   cmp bl, 1
  1595 0000096E 7504                     jne cls_fs_down_multiline
  1596                                  
  1597 00000970 B044                     mov al, 'D'
  1598 00000972 EB07                     jmp cs_fs_down_ml_out
  1599                                  
  1600                                   cls_fs_down_multiline:
  1601                                  
  1602 00000974 88D8                     mov al, bl
  1603 00000976 E82D06                   call puts_decimal_al
  1604 00000979 B054                     mov al, 'T'
  1605                                  
  1606                                   cs_fs_down_ml_out:
  1607                                  
  1608                                  %line 15+1 bios.asm
    16 0000097B 0F00                     db 0x0f, 0x00
    17                                  %line 1608+1 bios.asm
  1609                                  
  1610                                  
  1611                                  
  1612                                  
  1613 0000097D 5B                       pop bx
  1614 0000097E 58                       pop ax
  1615                                  
  1616 0000097F 50                       push ax
  1617 00000980 53                       push bx
  1618 00000981 52                       push dx
  1619 00000982 06                       push es
  1620                                  
  1621 00000983 B84000                   mov ax, 0x40
  1622 00000986 8EC0                     mov es, ax
  1623                                  
  1624 00000988 B402                     mov ah, 2
  1625 0000098A B700                     mov bh, 0
  1626 0000098C 268A365100               mov dh, [es:curpos_y-bios_data]
  1627 00000991 268A165000               mov dl, [es:curpos_x-bios_data]
  1628 00000996 CD10                     int 10h
  1629                                  
  1630 00000998 07                       pop es
  1631 00000999 5A                       pop dx
  1632 0000099A 5B                       pop bx
  1633 0000099B 58                       pop ax
  1634                                  
  1635                                  int10_scroll_down_vmem_update:
  1636                                  
  1637                                  
  1638                                  
  1639 0000099C 50                       push ax
  1640 0000099D 53                       push bx
  1641                                  
  1642 0000099E 1E                       push ds
  1643 0000099F 06                       push es
  1644 000009A0 51                       push cx
  1645 000009A1 52                       push dx
  1646 000009A2 56                       push si
  1647 000009A3 57                       push di
  1648                                  
  1649 000009A4 2EC606[8716]01           mov byte [cs:vram_dirty], 1
  1650                                  
  1651 000009AA 53                       push bx
  1652                                  
  1653 000009AB BB00B8                   mov bx, 0xb800
  1654 000009AE 8EC3                     mov es, bx
  1655 000009B0 8EDB                     mov ds, bx
  1656                                  
  1657 000009B2 5B                       pop bx
  1658 000009B3 88C3                     mov bl, al
  1659                                  
  1660                                   cls_vmem_scroll_down_next_line:
  1661                                  
  1662 000009B5 80FB00                   cmp bl, 0
  1663 000009B8 744A                     je cls_vmem_scroll_down_done
  1664                                  
  1665                                   cls_vmem_scroll_down_one:
  1666                                  
  1667 000009BA 53                       push bx
  1668 000009BB 52                       push dx
  1669                                  
  1670 000009BC B80000                   mov ax, 0
  1671 000009BF 88F0                     mov al, dh
  1672 000009C1 BB5000                   mov bx, 80
  1673 000009C4 F7E3                     mul bx
  1674 000009C6 00C8                     add al, cl
  1675 000009C8 80D400                   adc ah, 0
  1676 000009CB BB0200                   mov bx, 2
  1677 000009CE F7E3                     mul bx
  1678                                  
  1679 000009D0 5A                       pop dx
  1680 000009D1 5B                       pop bx
  1681                                  
  1682 000009D2 89C7                     mov di, ax
  1683 000009D4 89C6                     mov si, ax
  1684 000009D6 81EEA000                 sub si, 2*80
  1685                                  
  1686 000009DA B80000                   mov ax, 0
  1687 000009DD 00D0                     add al, dl
  1688 000009DF 80D400                   adc ah, 0
  1689 000009E2 40                       inc ax
  1690 000009E3 28C8                     sub al, cl
  1691 000009E5 80DC00                   sbb ah, 0
  1692                                  
  1693 000009E8 38F5                     cmp ch, dh
  1694 000009EA 730A                     jae cls_vmem_scroll_down_one_done
  1695                                  
  1696 000009EC 51                       push cx
  1697 000009ED 89C1                     mov cx, ax
  1698 000009EF F3A5                     rep movsw
  1699 000009F1 59                       pop cx
  1700                                  
  1701 000009F2 FECE                     dec dh
  1702 000009F4 EBC4                     jmp cls_vmem_scroll_down_one
  1703                                  
  1704                                   cls_vmem_scroll_down_one_done:
  1705                                  
  1706 000009F6 51                       push cx
  1707 000009F7 89C1                     mov cx, ax
  1708 000009F9 88FC                     mov ah, bh
  1709 000009FB B000                     mov al, 0
  1710 000009FD F3AB                     rep stosw
  1711 000009FF 59                       pop cx
  1712                                  
  1713 00000A00 FECB                     dec bl
  1714 00000A02 EBB1                     jmp cls_vmem_scroll_down_next_line
  1715                                  
  1716                                   cls_vmem_scroll_down_done:
  1717                                  
  1718 00000A04 5F                       pop di
  1719 00000A05 5E                       pop si
  1720 00000A06 5A                       pop dx
  1721 00000A07 59                       pop cx
  1722 00000A08 07                       pop es
  1723 00000A09 1F                       pop ds
  1724                                  
  1725                                  
  1726                                  
  1727                                  
  1728                                  
  1729                                  
  1730                                  
  1731                                  
  1732                                  
  1733                                  
  1734 00000A0A 5B                       pop bx
  1735 00000A0B 58                       pop ax
  1736 00000A0C CF                       iret
  1737                                  
  1738                                   int10_charatcur:
  1739                                  
  1740                                  
  1741                                  
  1742                                  
  1743                                  
  1744                                  
  1745 00000A0D 1E                       push ds
  1746 00000A0E 06                       push es
  1747 00000A0F 53                       push bx
  1748 00000A10 52                       push dx
  1749                                  
  1750 00000A11 BB4000                   mov bx, 0x40
  1751 00000A14 8EC3                     mov es, bx
  1752                                  
  1753 00000A16 BB00C0                   mov bx, 0xc000
  1754 00000A19 8EDB                     mov ds, bx
  1755                                  
  1756 00000A1B BBA000                   mov bx, 160
  1757 00000A1E B80000                   mov ax, 0
  1758 00000A21 26A05100                 mov al, [es:curpos_y-bios_data]
  1759 00000A25 F7E3                     mul bx
  1760                                  
  1761 00000A27 BB0000                   mov bx, 0
  1762 00000A2A 268A1E5000               mov bl, [es:curpos_x-bios_data]
  1763 00000A2F 01D8                     add ax, bx
  1764 00000A31 01D8                     add ax, bx
  1765 00000A33 89C3                     mov bx, ax
  1766                                  
  1767 00000A35 B407                     mov ah, 7
  1768 00000A37 8A07                     mov al, [bx]
  1769                                  
  1770 00000A39 5A                       pop dx
  1771 00000A3A 5B                       pop bx
  1772 00000A3B 07                       pop es
  1773 00000A3C 1F                       pop ds
  1774                                  
  1775 00000A3D CF                       iret
  1776                                  
  1777                                   i10_unsup:
  1778                                  
  1779 00000A3E CF                       iret
  1780                                  
  1781                                   int10_write_char:
  1782                                  
  1783                                  
  1784                                  
  1785                                  
  1786                                  
  1787 00000A3F 1E                       push ds
  1788 00000A40 06                       push es
  1789 00000A41 51                       push cx
  1790 00000A42 52                       push dx
  1791 00000A43 50                       push ax
  1792 00000A44 55                       push bp
  1793 00000A45 53                       push bx
  1794                                  
  1795 00000A46 50                       push ax
  1796                                  
  1797 00000A47 88C1                     mov cl, al
  1798 00000A49 B507                     mov ch, 7
  1799                                  
  1800 00000A4B BB4000                   mov bx, 0x40
  1801 00000A4E 8EC3                     mov es, bx
  1802                                  
  1803 00000A50 BB00C0                   mov bx, 0xc000
  1804 00000A53 8EDB                     mov ds, bx
  1805                                  
  1806 00000A55 BBA000                   mov bx, 160
  1807 00000A58 B80000                   mov ax, 0
  1808 00000A5B 26A05100                 mov al, [es:curpos_y-bios_data]
  1809 00000A5F F7E3                     mul bx
  1810                                  
  1811 00000A61 BB0000                   mov bx, 0
  1812 00000A64 268A1E5000               mov bl, [es:curpos_x-bios_data]
  1813 00000A69 D1E3                     shl bx, 1
  1814 00000A6B 01C3                     add bx, ax
  1815                                  
  1816 00000A6D 890F                     mov [bx], cx
  1817                                  
  1818 00000A6F 58                       pop ax
  1819 00000A70 50                       push ax
  1820                                  
  1821                                  %line 15+1 bios.asm
    16 00000A71 0F00                     db 0x0f, 0x00
    17                                  %line 1821+1 bios.asm
  1822                                  
  1823 00000A73 E99F00                   jmp int10_write_char_skip_lines
  1824                                  
  1825                                   int10_write_char_attrib:
  1826                                  
  1827                                  
  1828                                  
  1829                                  
  1830                                  
  1831 00000A76 1E                       push ds
  1832 00000A77 06                       push es
  1833 00000A78 51                       push cx
  1834 00000A79 52                       push dx
  1835 00000A7A 50                       push ax
  1836 00000A7B 55                       push bp
  1837 00000A7C 53                       push bx
  1838                                  
  1839 00000A7D 50                       push ax
  1840 00000A7E 51                       push cx
  1841                                  
  1842 00000A7F 88C1                     mov cl, al
  1843 00000A81 88DD                     mov ch, bl
  1844                                  
  1845 00000A83 BB4000                   mov bx, 0x40
  1846 00000A86 8EC3                     mov es, bx
  1847                                  
  1848 00000A88 BB00C0                   mov bx, 0xc000
  1849 00000A8B 8EDB                     mov ds, bx
  1850                                  
  1851 00000A8D BBA000                   mov bx, 160
  1852 00000A90 B80000                   mov ax, 0
  1853 00000A93 26A05100                 mov al, [es:curpos_y-bios_data]
  1854 00000A97 F7E3                     mul bx
  1855                                  
  1856 00000A99 BB0000                   mov bx, 0
  1857 00000A9C 268A1E5000               mov bl, [es:curpos_x-bios_data]
  1858 00000AA1 D1E3                     shl bx, 1
  1859 00000AA3 01C3                     add bx, ax
  1860                                  
  1861 00000AA5 890F                     mov [bx], cx
  1862                                  
  1863 00000AA7 88EB                     mov bl, ch
  1864                                  
  1865 00000AA9 88DF                     mov bh, bl
  1866 00000AAB 80E307                   and bl, 7
  1867                                  
  1868 00000AAE 89DD                     mov bp, bx
  1869 00000AB0 81E5FF00                 and bp, 0xff
  1870 00000AB4 2E8A9E[5516]             mov bl, byte [cs:bp+colour_table]
  1871                                  
  1872 00000AB9 80E708                   and bh, 8
  1873                                  [cpu 186]
  1874 00000ABC C0EF03                   shr bh, 3
  1875                                  [cpu 8086]
  1876                                  
  1877 00000ABF B01B                     mov al, 0x1B
  1878                                  %line 15+1 bios.asm
    16 00000AC1 0F00                     db 0x0f, 0x00
    17                                  %line 1878+1 bios.asm
  1879 00000AC3 B05B                     mov al, '['
  1880                                  %line 15+1 bios.asm
    16 00000AC5 0F00                     db 0x0f, 0x00
    17                                  %line 1880+1 bios.asm
  1881 00000AC7 88F8                     mov al, bh
  1882 00000AC9 E8DA04                   call puts_decimal_al
  1883 00000ACC B03B                     mov al, ';'
  1884                                  %line 15+1 bios.asm
    16 00000ACE 0F00                     db 0x0f, 0x00
    17                                  %line 1884+1 bios.asm
  1885 00000AD0 88D8                     mov al, bl
  1886 00000AD2 E8D104                   call puts_decimal_al
  1887                                  
  1888 00000AD5 88EB                     mov bl, ch
  1889                                  
  1890 00000AD7 88DF                     mov bh, bl
  1891                                  [cpu 186]
  1892 00000AD9 C0EB04                   shr bl, 4
  1893                                  [cpu 8086]
  1894 00000ADC 80E307                   and bl, 7
  1895                                  
  1896 00000ADF 89DD                     mov bp, bx
  1897 00000AE1 81E5FF00                 and bp, 0xff
  1898 00000AE5 2E8A9E[5516]             mov bl, byte [cs:bp+colour_table]
  1899                                  
  1900 00000AEA 80C30A                   add bl, 10
  1901                                  
  1902                                  
  1903                                  
  1904 00000AED B03B                     mov al, ';'
  1905                                  %line 15+1 bios.asm
    16 00000AEF 0F00                     db 0x0f, 0x00
    17                                  %line 1905+1 bios.asm
  1906 00000AF1 88D8                     mov al, bl
  1907 00000AF3 E8B004                   call puts_decimal_al
  1908 00000AF6 B06D                     mov al, 'm'
  1909                                  %line 15+1 bios.asm
    16 00000AF8 0F00                     db 0x0f, 0x00
    17                                  %line 1909+1 bios.asm
  1910                                  
  1911 00000AFA 59                       pop cx
  1912 00000AFB 58                       pop ax
  1913 00000AFC 50                       push ax
  1914                                  
  1915                                   out_another_char:
  1916                                  
  1917                                  %line 15+1 bios.asm
    16 00000AFD 0F00                     db 0x0f, 0x00
    17                                  %line 1917+1 bios.asm
  1918 00000AFF 49                       dec cx
  1919 00000B00 83F900                   cmp cx, 0
  1920 00000B03 75F8                     jne out_another_char
  1921                                  
  1922 00000B05 B01B                     mov al, 0x1B
  1923                                  %line 15+1 bios.asm
    16 00000B07 0F00                     db 0x0f, 0x00
    17                                  %line 1923+1 bios.asm
  1924 00000B09 B05B                     mov al, '['
  1925                                  %line 15+1 bios.asm
    16 00000B0B 0F00                     db 0x0f, 0x00
    17                                  %line 1925+1 bios.asm
  1926 00000B0D B030                     mov al, '0'
  1927                                  %line 15+1 bios.asm
    16 00000B0F 0F00                     db 0x0f, 0x00
    17                                  %line 1927+1 bios.asm
  1928 00000B11 B06D                     mov al, 'm'
  1929                                  %line 15+1 bios.asm
    16 00000B13 0F00                     db 0x0f, 0x00
    17                                  %line 1929+1 bios.asm
  1930                                  
  1931                                   int10_write_char_skip_lines:
  1932                                  
  1933 00000B15 58                       pop ax
  1934                                  
  1935 00000B16 06                       push es
  1936 00000B17 1F                       pop ds
  1937                                  
  1938 00000B18 3C08                     cmp al, 0x08
  1939 00000B1A 751B                     jne int10_write_char_attrib_inc_x
  1940                                  
  1941 00000B1C FE0E5000                 dec byte [curpos_x-bios_data]
  1942 00000B20 FE0E9D00                 dec byte [crt_curpos_x-bios_data]
  1943 00000B24 803E500000               cmp byte [curpos_x-bios_data], 0
  1944 00000B29 7F63                     jg int10_write_char_attrib_done
  1945                                  
  1946 00000B2B C606500000               mov byte [curpos_x-bios_data], 0
  1947 00000B30 C6069D0000               mov byte [crt_curpos_x-bios_data], 0
  1948 00000B35 EB57                     jmp int10_write_char_attrib_done
  1949                                  
  1950                                   int10_write_char_attrib_inc_x:
  1951                                  
  1952 00000B37 3C0A                     cmp al, 0x0A
  1953 00000B39 7421                     je int10_write_char_attrib_newline
  1954                                  
  1955 00000B3B 3C0D                     cmp al, 0x0D
  1956 00000B3D 750C                     jne int10_write_char_attrib_not_cr
  1957                                  
  1958 00000B3F C606500000               mov byte [curpos_x-bios_data], 0
  1959 00000B44 C6069D0000               mov byte [crt_curpos_x-bios_data], 0
  1960 00000B49 EB43                     jmp int10_write_char_attrib_done
  1961                                  
  1962                                   int10_write_char_attrib_not_cr:
  1963                                  
  1964 00000B4B FE065000                 inc byte [curpos_x-bios_data]
  1965 00000B4F FE069D00                 inc byte [crt_curpos_x-bios_data]
  1966 00000B53 803E500050               cmp byte [curpos_x-bios_data], 80
  1967 00000B58 7D02                     jge int10_write_char_attrib_newline
  1968 00000B5A EB32                     jmp int10_write_char_attrib_done
  1969                                  
  1970                                   int10_write_char_attrib_newline:
  1971                                  
  1972 00000B5C C606500000               mov byte [curpos_x-bios_data], 0
  1973 00000B61 C6069D0000               mov byte [crt_curpos_x-bios_data], 0
  1974 00000B66 FE065100                 inc byte [curpos_y-bios_data]
  1975 00000B6A FE069E00                 inc byte [crt_curpos_y-bios_data]
  1976                                  
  1977 00000B6E 803E510019               cmp byte [curpos_y-bios_data], 25
  1978 00000B73 7219                     jb int10_write_char_attrib_done
  1979 00000B75 C606510018               mov byte [curpos_y-bios_data], 24
  1980 00000B7A C6069E0018               mov byte [crt_curpos_y-bios_data], 24
  1981                                  
  1982 00000B7F B707                     mov bh, 7
  1983 00000B81 B001                     mov al, 1
  1984 00000B83 B90000                   mov cx, 0
  1985 00000B86 BA4F18                   mov dx, 0x184f
  1986                                  
  1987 00000B89 9C                       pushf
  1988 00000B8A 0E                       push cs
  1989 00000B8B E8E9FC                   call int10_scroll_up_vmem_update
  1990                                  
  1991                                   int10_write_char_attrib_done:
  1992                                  
  1993 00000B8E 5B                       pop bx
  1994 00000B8F 5D                       pop bp
  1995 00000B90 58                       pop ax
  1996 00000B91 5A                       pop dx
  1997 00000B92 59                       pop cx
  1998 00000B93 07                       pop es
  1999 00000B94 1F                       pop ds
  2000                                  
  2001 00000B95 CF                       iret
  2002                                  
  2003                                   int10_get_vm:
  2004                                  
  2005 00000B96 06                       push es
  2006                                  
  2007 00000B97 B84000                   mov ax, 0x40
  2008 00000B9A 8EC0                     mov es, ax
  2009                                  
  2010 00000B9C B450                     mov ah, 80
  2011 00000B9E 26A04900                 mov al, [es:vidmode-bios_data]
  2012 00000BA2 B700                     mov bh, 0
  2013                                  
  2014 00000BA4 07                       pop es
  2015                                  
  2016 00000BA5 CF                       iret
  2017                                  
  2018                                   int10_features:
  2019                                  
  2020                                  
  2021                                  
  2022                                  
  2023                                  
  2024                                  
  2025                                  
  2026                                  
  2027                                  
  2028                                  int11:
  2029 00000BA6 2EA1[EA13]               mov ax, [cs:equip]
  2030 00000BAA CF                       iret
  2031                                  
  2032                                  
  2033                                  
  2034                                  int12:
  2035 00000BAB B88002                   mov ax, 0x280
  2036 00000BAE CF                       iret
  2037                                  
  2038                                  
  2039                                  
  2040                                  int13:
  2041 00000BAF 80FC00                   cmp ah, 0x00
  2042 00000BB2 7462                     je int13_reset_disk
  2043 00000BB4 80FC01                   cmp ah, 0x01
  2044 00000BB7 7460                     je int13_last_status
  2045                                  
  2046 00000BB9 80FA80                   cmp dl, 0x80
  2047 00000BBC 750D                     jne i13_diskok
  2048                                  
  2049                                  
  2050 00000BBE 2E833E[600F]02           cmp word [cs:num_disks], 2
  2051 00000BC4 7D05                     jge i13_diskok
  2052                                  
  2053                                  
  2054 00000BC6 B40F                     mov ah, 15
  2055 00000BC8 E97E05                   jmp reach_stack_stc
  2056                                  
  2057                                   i13_diskok:
  2058                                  
  2059 00000BCB 80FC02                   cmp ah, 0x02
  2060 00000BCE 7454                     je int13_read_disk
  2061 00000BD0 80FC03                   cmp ah, 0x03
  2062 00000BD3 7503E9B500               je int13_write_disk
  2063 00000BD8 80FC04                   cmp ah, 0x04
  2064 00000BDB 7503E91001               je int13_verify
  2065 00000BE0 80FC05                   cmp ah, 0x05
  2066 00000BE3 7503E97F01               je int13_format
  2067 00000BE8 80FC08                   cmp ah, 0x08
  2068 00000BEB 7503E90501               je int13_getparams
  2069 00000BF0 80FC0C                   cmp ah, 0x0c
  2070 00000BF3 7503E95501               je int13_seek
  2071 00000BF8 80FC10                   cmp ah, 0x10
  2072 00000BFB 7503E95201               je int13_hdready
  2073 00000C00 80FC15                   cmp ah, 0x15
  2074 00000C03 7503E96401               je int13_getdisktype
  2075 00000C08 80FC16                   cmp ah, 0x16
  2076 00000C0B 7503E98401               je int13_diskchange
  2077                                  
  2078 00000C10 B401                     mov ah, 1
  2079 00000C12 E93405                   jmp reach_stack_stc
  2080                                  
  2081 00000C15 CF                       iret
  2082                                  
  2083                                   int13_reset_disk:
  2084                                  
  2085 00000C16 E93905                   jmp reach_stack_clc
  2086                                  
  2087                                   int13_last_status:
  2088                                  
  2089 00000C19 2E8A26[1B14]             mov ah, [cs:disk_laststatus]
  2090 00000C1E 7402                     je ls_no_error
  2091                                  
  2092 00000C20 F9                       stc
  2093 00000C21 CF                       iret
  2094                                  
  2095                                   ls_no_error:
  2096                                  
  2097 00000C22 F8                       clc
  2098 00000C23 CF                       iret
  2099                                  
  2100                                   int13_read_disk:
  2101                                  
  2102 00000C24 52                       push dx
  2103                                  
  2104 00000C25 80FA00                   cmp dl, 0
  2105 00000C28 740B                     je i_flop_rd
  2106 00000C2A 80FA80                   cmp dl, 0x80
  2107 00000C2D 7415                     je i_hd_rd
  2108                                  
  2109 00000C2F 5A                       pop dx
  2110 00000C30 B401                     mov ah, 1
  2111 00000C32 E91405                   jmp reach_stack_stc
  2112                                  
  2113                                   i_flop_rd:
  2114                                  
  2115 00000C35 56                       push si
  2116 00000C36 55                       push bp
  2117                                  
  2118 00000C37 2E3A0E[390F]             cmp cl, [cs:int1e_spt]
  2119 00000C3C 7741                     ja rd_error
  2120                                  
  2121 00000C3E 5D                       pop bp
  2122 00000C3F 5E                       pop si
  2123                                  
  2124 00000C40 B201                     mov dl, 1
  2125 00000C42 EB02                     jmp i_rd
  2126                                  
  2127                                   i_hd_rd:
  2128                                  
  2129 00000C44 B200                     mov dl, 0
  2130                                  
  2131                                   i_rd:
  2132                                  
  2133 00000C46 56                       push si
  2134 00000C47 55                       push bp
  2135                                  
  2136                                  
  2137                                  
  2138 00000C48 E89F03                   call chs_to_abs
  2139                                  
  2140                                  
  2141                                  
  2142 00000C4B B400                     mov ah, 0
  2143                                  [cpu 186]
  2144 00000C4D C1E009                   shl ax, 9
  2145                                  %line 23+1 bios.asm
    24 00000C50 0F02                     db 0x0f, 0x02
    25                                  %line 2145+1 bios.asm
  2146 00000C52 C1E809                   shr ax, 9
  2147                                  [cpu 8086]
  2148 00000C55 B402                     mov ah, 0x02
  2149                                  
  2150 00000C57 3C00                     cmp al, 0
  2151 00000C59 7424                     je rd_error
  2152                                  
  2153                                  
  2154                                  
  2155                                  
  2156 00000C5B 83FA01                   cmp dx, 1
  2157 00000C5E 751A                     jne rd_noerror
  2158 00000C60 83F901                   cmp cx, 1
  2159 00000C63 7515                     jne rd_noerror
  2160                                  
  2161 00000C65 50                       push ax
  2162                                  
  2163 00000C66 268A4718                 mov al, [es:bx+24]
  2164                                  
  2165                                  
  2166                                  
  2167 00000C6A 3C09                     cmp al, 9
  2168 00000C6C 7407                     je rd_update_spt
  2169 00000C6E 3C12                     cmp al, 18
  2170 00000C70 7403                     je rd_update_spt
  2171                                  
  2172 00000C72 58                       pop ax
  2173                                  
  2174 00000C73 EB05                     jmp rd_noerror
  2175                                  
  2176                                   rd_update_spt:
  2177                                  
  2178 00000C75 2EA2[390F]               mov [cs:int1e_spt], al
  2179 00000C79 58                       pop ax
  2180                                  
  2181                                   rd_noerror:
  2182                                  
  2183 00000C7A F8                       clc
  2184 00000C7B B400                     mov ah, 0
  2185 00000C7D EB03                     jmp rd_finish
  2186                                  
  2187                                   rd_error:
  2188                                  
  2189 00000C7F F9                       stc
  2190 00000C80 B404                     mov ah, 4
  2191                                  
  2192                                   rd_finish:
  2193                                  
  2194 00000C82 5D                       pop bp
  2195 00000C83 5E                       pop si
  2196 00000C84 5A                       pop dx
  2197                                  
  2198 00000C85 2E8826[1B14]             mov [cs:disk_laststatus], ah
  2199 00000C8A E9CE04                   jmp reach_stack_carry
  2200                                  
  2201                                   int13_write_disk:
  2202                                  
  2203 00000C8D 52                       push dx
  2204                                  
  2205 00000C8E 80FA00                   cmp dl, 0
  2206 00000C91 740B                     je i_flop_wr
  2207 00000C93 80FA80                   cmp dl, 0x80
  2208 00000C96 740A                     je i_hd_wr
  2209                                  
  2210 00000C98 5A                       pop dx
  2211 00000C99 B401                     mov ah, 1
  2212 00000C9B E9AB04                   jmp reach_stack_stc
  2213                                  
  2214                                   i_flop_wr:
  2215                                  
  2216 00000C9E B201                     mov dl, 1
  2217 00000CA0 EB02                     jmp i_wr
  2218                                  
  2219                                   i_hd_wr:
  2220                                  
  2221 00000CA2 B200                     mov dl, 0
  2222                                  
  2223                                   i_wr:
  2224                                  
  2225 00000CA4 56                       push si
  2226 00000CA5 55                       push bp
  2227 00000CA6 51                       push cx
  2228 00000CA7 57                       push di
  2229                                  
  2230                                  
  2231                                  
  2232 00000CA8 E83F03                   call chs_to_abs
  2233                                  
  2234                                  
  2235                                  
  2236 00000CAB 80FA00                   cmp dl, 0
  2237 00000CAE 751B                     jne wr_fine
  2238                                  
  2239                                  
  2240                                  
  2241                                  
  2242                                  
  2243 00000CB0 89E9                     mov cx, bp
  2244 00000CB2 89F7                     mov di, si
  2245                                  
  2246 00000CB4 B400                     mov ah, 0
  2247 00000CB6 01C1                     add cx, ax
  2248 00000CB8 83D700                   adc di, 0
  2249                                  
  2250 00000CBB 2E3B3E[620F]             cmp di, [cs:hd_secs_hi]
  2251 00000CC0 771E                     ja wr_error
  2252 00000CC2 7207                     jb wr_fine
  2253 00000CC4 2E3B0E[640F]             cmp cx, [cs:hd_secs_lo]
  2254 00000CC9 7715                     ja wr_error
  2255                                  
  2256                                  wr_fine:
  2257                                  
  2258 00000CCB B400                     mov ah, 0
  2259                                  [cpu 186]
  2260 00000CCD C1E009                   shl ax, 9
  2261                                  %line 27+1 bios.asm
    28 00000CD0 0F03                     db 0x0f, 0x03
    29                                  %line 2261+1 bios.asm
  2262 00000CD2 C1E809                   shr ax, 9
  2263                                  [cpu 8086]
  2264 00000CD5 B403                     mov ah, 0x03
  2265                                  
  2266 00000CD7 3C00                     cmp al, 0
  2267 00000CD9 7405                     je wr_error
  2268                                  
  2269 00000CDB F8                       clc
  2270 00000CDC B400                     mov ah, 0
  2271 00000CDE EB03                     jmp wr_finish
  2272                                  
  2273                                   wr_error:
  2274                                  
  2275 00000CE0 F9                       stc
  2276 00000CE1 B404                     mov ah, 4
  2277                                  
  2278                                   wr_finish:
  2279                                  
  2280 00000CE3 5F                       pop di
  2281 00000CE4 59                       pop cx
  2282 00000CE5 5D                       pop bp
  2283 00000CE6 5E                       pop si
  2284 00000CE7 5A                       pop dx
  2285                                  
  2286 00000CE8 2E8826[1B14]             mov [cs:disk_laststatus], ah
  2287 00000CED E96B04                   jmp reach_stack_carry
  2288                                  
  2289                                   int13_verify:
  2290                                  
  2291 00000CF0 B400                     mov ah, 0
  2292 00000CF2 E95D04                   jmp reach_stack_clc
  2293                                  
  2294                                   int13_getparams:
  2295                                  
  2296 00000CF5 80FA00                   cmp dl, 0
  2297 00000CF8 740F                     je i_gp_fl
  2298 00000CFA 80FA80                   cmp dl, 0x80
  2299 00000CFD 7428                     je i_gp_hd
  2300                                  
  2301 00000CFF B401                     mov ah, 0x01
  2302 00000D01 2E8826[1B14]             mov [cs:disk_laststatus], ah
  2303 00000D06 E94004                   jmp reach_stack_stc
  2304                                  
  2305                                   i_gp_fl:
  2306                                  
  2307 00000D09 0E                       push cs
  2308 00000D0A 07                       pop es
  2309 00000D0B BF[350F]                 mov di, int1e
  2310                                  
  2311 00000D0E B80000                   mov ax, 0
  2312 00000D11 BB0400                   mov bx, 4
  2313 00000D14 B54F                     mov ch, 0x4f
  2314 00000D16 2E8A0E[390F]             mov cl, [cs:int1e_spt]
  2315 00000D1B BA0101                   mov dx, 0x0101
  2316                                  
  2317 00000D1E 2EC606[1B14]00           mov byte [cs:disk_laststatus], 0
  2318 00000D24 E92B04                   jmp reach_stack_clc
  2319                                  
  2320                                   i_gp_hd:
  2321                                  
  2322 00000D27 B80000                   mov ax, 0
  2323 00000D2A BB0000                   mov bx, 0
  2324 00000D2D B201                     mov dl, 1
  2325 00000D2F 2E8A36[6A0F]             mov dh, [cs:hd_max_head]
  2326 00000D34 2E8B0E[680F]             mov cx, [cs:hd_max_track]
  2327 00000D39 D0CD                     ror ch, 1
  2328 00000D3B D0CD                     ror ch, 1
  2329 00000D3D 2E022E[660F]             add ch, [cs:hd_max_sector]
  2330 00000D42 86CD                     xchg ch, cl
  2331                                  
  2332 00000D44 2EC606[1B14]00           mov byte [cs:disk_laststatus], 0
  2333 00000D4A E90504                   jmp reach_stack_clc
  2334                                  
  2335                                   int13_seek:
  2336                                  
  2337 00000D4D B400                     mov ah, 0
  2338 00000D4F E90004                   jmp reach_stack_clc
  2339                                  
  2340                                   int13_hdready:
  2341                                  
  2342 00000D52 2E803E[600F]02           cmp byte [cs:num_disks], 2
  2343 00000D58 750A                     jne int13_hdready_nohd
  2344 00000D5A 80FA80                   cmp dl, 0x80
  2345 00000D5D 7505                     jne int13_hdready_nohd
  2346                                  
  2347 00000D5F B400                     mov ah, 0
  2348 00000D61 E9EE03                   jmp reach_stack_clc
  2349                                  
  2350                                   int13_hdready_nohd:
  2351                                  
  2352 00000D64 E9E203                   jmp reach_stack_stc
  2353                                  
  2354                                   int13_format:
  2355                                  
  2356 00000D67 B400                     mov ah, 0
  2357 00000D69 E9E603                   jmp reach_stack_clc
  2358                                  
  2359                                   int13_getdisktype:
  2360                                  
  2361 00000D6C 80FA00                   cmp dl, 0
  2362 00000D6F 740F                     je gdt_flop
  2363 00000D71 80FA80                   cmp dl, 0x80
  2364 00000D74 740F                     je gdt_hd
  2365                                  
  2366 00000D76 B40F                     mov ah, 15
  2367 00000D78 2E8826[1B14]             mov [cs:disk_laststatus], ah
  2368 00000D7D E9C903                   jmp reach_stack_stc
  2369                                  
  2370                                   gdt_flop:
  2371                                  
  2372 00000D80 B401                     mov ah, 1
  2373 00000D82 E9CD03                   jmp reach_stack_clc
  2374                                  
  2375                                   gdt_hd:
  2376                                  
  2377 00000D85 B403                     mov ah, 3
  2378 00000D87 2E8B0E[620F]             mov cx, [cs:hd_secs_hi]
  2379 00000D8C 2E8B16[640F]             mov dx, [cs:hd_secs_lo]
  2380 00000D91 E9BE03                   jmp reach_stack_clc
  2381                                  
  2382                                   int13_diskchange:
  2383                                  
  2384 00000D94 B400                     mov ah, 0
  2385 00000D96 E9B903                   jmp reach_stack_clc
  2386                                  
  2387                                  
  2388                                  
  2389                                  int14:
  2390 00000D99 80FC00                   cmp ah, 0
  2391 00000D9C 7403                     je int14_init
  2392                                  
  2393 00000D9E E9A803                   jmp reach_stack_stc
  2394                                  
  2395                                   int14_init:
  2396                                  
  2397 00000DA1 B80000                   mov ax, 0
  2398 00000DA4 E9A203                   jmp reach_stack_stc
  2399                                  
  2400                                  
  2401                                  
  2402                                  int15:
  2403                                  
  2404                                  
  2405                                  
  2406                                  
  2407                                  
  2408                                  
  2409                                  
  2410                                  
  2411                                  
  2412                                  
  2413                                  
  2414                                  
  2415                                  
  2416 00000DA7 B486                     mov ah, 0x86
  2417                                  
  2418 00000DA9 E99D03                   jmp reach_stack_stc
  2419                                  
  2420                                  
  2421                                  
  2422                                  
  2423                                  
  2424                                  
  2425                                  
  2426                                  
  2427                                  
  2428                                  
  2429                                  
  2430                                  
  2431                                  
  2432                                  
  2433                                  
  2434                                  
  2435                                  
  2436                                  
  2437                                  
  2438                                  
  2439                                  
  2440                                  
  2441                                  
  2442                                  
  2443                                  
  2444                                  
  2445                                  
  2446                                  
  2447                                  int16:
  2448 00000DAC 80FC00                   cmp ah, 0x00
  2449 00000DAF 7410                     je kb_getkey
  2450 00000DB1 80FC01                   cmp ah, 0x01
  2451 00000DB4 7439                     je kb_checkkey
  2452 00000DB6 80FC02                   cmp ah, 0x02
  2453 00000DB9 7458                     je kb_shiftflags
  2454 00000DBB 80FC12                   cmp ah, 0x12
  2455 00000DBE 7461                     je kb_extshiftflags
  2456                                  
  2457 00000DC0 CF                       iret
  2458                                  
  2459                                   kb_getkey:
  2460                                  
  2461 00000DC1 06                       push es
  2462 00000DC2 53                       push bx
  2463 00000DC3 51                       push cx
  2464 00000DC4 52                       push dx
  2465                                  
  2466 00000DC5 BB4000                   mov bx, 0x40
  2467 00000DC8 8EC3                     mov es, bx
  2468                                  
  2469                                   kb_gkblock:
  2470                                  
  2471 00000DCA FA                       cli
  2472                                  
  2473 00000DCB 268B0E1C00               mov cx, [es:kbbuf_tail-bios_data]
  2474 00000DD0 268B1E1A00               mov bx, [es:kbbuf_head-bios_data]
  2475 00000DD5 268B17                   mov dx, [es:bx]
  2476                                  
  2477 00000DD8 FB                       sti
  2478                                  
  2479                                  
  2480 00000DD9 39D9                     cmp cx, bx
  2481 00000DDB 74ED                     je kb_gkblock
  2482                                  
  2483 00000DDD 2683061A0002             add word [es:kbbuf_head-bios_data], 2
  2484 00000DE3 E8D501                   call kb_adjust_buf
  2485                                  
  2486 00000DE6 88F4                     mov ah, dh
  2487 00000DE8 88D0                     mov al, dl
  2488                                  
  2489 00000DEA 5A                       pop dx
  2490 00000DEB 59                       pop cx
  2491 00000DEC 5B                       pop bx
  2492 00000DED 07                       pop es
  2493                                  
  2494 00000DEE CF                       iret
  2495                                  
  2496                                   kb_checkkey:
  2497                                  
  2498 00000DEF 06                       push es
  2499 00000DF0 53                       push bx
  2500 00000DF1 51                       push cx
  2501 00000DF2 52                       push dx
  2502                                  
  2503 00000DF3 BB4000                   mov bx, 0x40
  2504 00000DF6 8EC3                     mov es, bx
  2505                                  
  2506 00000DF8 268B0E1C00               mov cx, [es:kbbuf_tail-bios_data]
  2507 00000DFD 268B1E1A00               mov bx, [es:kbbuf_head-bios_data]
  2508 00000E02 268B17                   mov dx, [es:bx]
  2509                                  
  2510 00000E05 FB                       sti
  2511                                  
  2512                                  
  2513 00000E06 39D9                     cmp cx, bx
  2514                                  
  2515 00000E08 88F4                     mov ah, dh
  2516 00000E0A 88D0                     mov al, dl
  2517                                  
  2518 00000E0C 5A                       pop dx
  2519 00000E0D 59                       pop cx
  2520 00000E0E 5B                       pop bx
  2521 00000E0F 07                       pop es
  2522                                  
  2523 00000E10 CA0200                   retf 2
  2524                                  
  2525                                   kb_shiftflags:
  2526                                  
  2527 00000E13 06                       push es
  2528 00000E14 53                       push bx
  2529                                  
  2530 00000E15 BB4000                   mov bx, 0x40
  2531 00000E18 8EC3                     mov es, bx
  2532                                  
  2533 00000E1A 26A01700                 mov al, [es:keyflags1-bios_data]
  2534                                  
  2535 00000E1E 5B                       pop bx
  2536 00000E1F 07                       pop es
  2537                                  
  2538 00000E20 CF                       iret
  2539                                  
  2540                                   kb_extshiftflags:
  2541                                  
  2542 00000E21 06                       push es
  2543 00000E22 53                       push bx
  2544                                  
  2545 00000E23 BB4000                   mov bx, 0x40
  2546 00000E26 8EC3                     mov es, bx
  2547                                  
  2548 00000E28 26A01700                 mov al, [es:keyflags1-bios_data]
  2549 00000E2C 88C4                     mov ah, al
  2550                                  
  2551 00000E2E 5B                       pop bx
  2552 00000E2F 07                       pop es
  2553                                  
  2554 00000E30 CF                       iret
  2555                                  
  2556                                  
  2557                                  
  2558                                  int17:
  2559 00000E31 80FC01                   cmp ah, 0x01
  2560 00000E34 7403                     je int17_initprint
  2561                                  
  2562 00000E36 E91003                   jmp reach_stack_stc
  2563                                  
  2564                                   int17_initprint:
  2565                                  
  2566 00000E39 B401                     mov ah, 1
  2567 00000E3B E90B03                   jmp reach_stack_stc
  2568                                  
  2569                                  
  2570                                  
  2571                                  int19:
  2572 00000E3E E902F3                   jmp boot
  2573                                  
  2574                                  
  2575                                  
  2576                                  int1a:
  2577 00000E41 80FC00                   cmp ah, 0
  2578 00000E44 7416                     je int1a_getsystime
  2579 00000E46 80FC02                   cmp ah, 2
  2580 00000E49 7470                     je int1a_gettime
  2581 00000E4B 80FC04                   cmp ah, 4
  2582 00000E4E 7503E9A400               je int1a_getdate
  2583 00000E53 80FC0F                   cmp ah, 0x0f
  2584 00000E56 7503E9D600               je int1a_init
  2585                                  
  2586 00000E5B CF                       iret
  2587                                  
  2588                                   int1a_getsystime:
  2589                                  
  2590 00000E5C 50                       push ax
  2591 00000E5D 53                       push bx
  2592 00000E5E 1E                       push ds
  2593 00000E5F 06                       push es
  2594                                  
  2595 00000E60 0E                       push cs
  2596 00000E61 0E                       push cs
  2597 00000E62 1F                       pop ds
  2598 00000E63 07                       pop es
  2599                                  
  2600 00000E64 BB[F11D]                 mov bx, timetable
  2601                                  
  2602                                  %line 19+1 bios.asm
    20 00000E67 0F01                     db 0x0f, 0x01
    21                                  %line 2602+1 bios.asm
  2603                                  
  2604 00000E69 B8B600                   mov ax, 182
  2605 00000E6C F726[151E]               mul word [tm_msec]
  2606 00000E70 BB1027                   mov bx, 10000
  2607 00000E73 F7F3                     div bx
  2608 00000E75 A3[151E]                 mov [tm_msec], ax
  2609                                  
  2610 00000E78 B8B600                   mov ax, 182
  2611 00000E7B F726[F11D]               mul word [tm_sec]
  2612 00000E7F BB0A00                   mov bx, 10
  2613 00000E82 BA0000                   mov dx, 0
  2614 00000E85 F7F3                     div bx
  2615 00000E87 A3[F11D]                 mov [tm_sec], ax
  2616                                  
  2617 00000E8A B84404                   mov ax, 1092
  2618 00000E8D F726[F51D]               mul word [tm_min]
  2619 00000E91 A3[F51D]                 mov [tm_min], ax
  2620                                  
  2621 00000E94 B8F0FF                   mov ax, 65520
  2622 00000E97 F726[F91D]               mul word [tm_hour]
  2623                                  
  2624 00000E9B 0306[151E]               add ax, [tm_msec]
  2625 00000E9F 83D200                   adc dx, 0
  2626 00000EA2 0306[F11D]               add ax, [tm_sec]
  2627 00000EA6 83D200                   adc dx, 0
  2628 00000EA9 0306[F51D]               add ax, [tm_min]
  2629 00000EAD 83D200                   adc dx, 0
  2630                                  
  2631 00000EB0 52                       push dx
  2632 00000EB1 50                       push ax
  2633 00000EB2 5A                       pop dx
  2634 00000EB3 59                       pop cx
  2635                                  
  2636 00000EB4 07                       pop es
  2637 00000EB5 1F                       pop ds
  2638 00000EB6 5B                       pop bx
  2639 00000EB7 58                       pop ax
  2640                                  
  2641 00000EB8 B000                     mov al, 0
  2642 00000EBA CF                       iret
  2643                                  
  2644                                   int1a_gettime:
  2645                                  
  2646                                  
  2647                                  
  2648                                  
  2649 00000EBB 1E                       push ds
  2650 00000EBC 06                       push es
  2651 00000EBD 50                       push ax
  2652 00000EBE 53                       push bx
  2653                                  
  2654 00000EBF 0E                       push cs
  2655 00000EC0 0E                       push cs
  2656 00000EC1 1F                       pop ds
  2657 00000EC2 07                       pop es
  2658                                  
  2659 00000EC3 BB[F11D]                 mov bx, timetable
  2660                                  
  2661                                  %line 19+1 bios.asm
    20 00000EC6 0F01                     db 0x0f, 0x01
    21                                  %line 2661+1 bios.asm
  2662                                  
  2663 00000EC8 B80000                   mov ax, 0
  2664 00000ECB 8B0E[F91D]               mov cx, [tm_hour]
  2665 00000ECF E8A500                   call hex_to_bcd
  2666 00000ED2 88C7                     mov bh, al
  2667                                  
  2668 00000ED4 B80000                   mov ax, 0
  2669 00000ED7 8B0E[F51D]               mov cx, [tm_min]
  2670 00000EDB E89900                   call hex_to_bcd
  2671 00000EDE 88C3                     mov bl, al
  2672                                  
  2673 00000EE0 B80000                   mov ax, 0
  2674 00000EE3 8B0E[F11D]               mov cx, [tm_sec]
  2675 00000EE7 E88D00                   call hex_to_bcd
  2676 00000EEA 88C6                     mov dh, al
  2677                                  
  2678 00000EEC B200                     mov dl, 0
  2679                                  
  2680 00000EEE 89D9                     mov cx, bx
  2681                                  
  2682 00000EF0 5B                       pop bx
  2683 00000EF1 58                       pop ax
  2684 00000EF2 07                       pop es
  2685 00000EF3 1F                       pop ds
  2686                                  
  2687 00000EF4 E95B02                   jmp reach_stack_clc
  2688                                  
  2689                                   int1a_getdate:
  2690                                  
  2691                                  
  2692                                  
  2693 00000EF7 1E                       push ds
  2694 00000EF8 06                       push es
  2695 00000EF9 53                       push bx
  2696 00000EFA 50                       push ax
  2697                                  
  2698 00000EFB 0E                       push cs
  2699 00000EFC 0E                       push cs
  2700 00000EFD 1F                       pop ds
  2701 00000EFE 07                       pop es
  2702                                  
  2703 00000EFF BB[F11D]                 mov bx, timetable
  2704                                  
  2705                                  %line 19+1 bios.asm
    20 00000F02 0F01                     db 0x0f, 0x01
    21                                  %line 2705+1 bios.asm
  2706                                  
  2707 00000F04 B80019                   mov ax, 0x1900
  2708 00000F07 8B0E[051E]               mov cx, [tm_year]
  2709 00000F0B E86900                   call hex_to_bcd
  2710 00000F0E 89C1                     mov cx, ax
  2711 00000F10 51                       push cx
  2712                                  
  2713 00000F11 B80100                   mov ax, 1
  2714 00000F14 8B0E[011E]               mov cx, [tm_mon]
  2715 00000F18 E85C00                   call hex_to_bcd
  2716 00000F1B 88C6                     mov dh, al
  2717                                  
  2718 00000F1D B80000                   mov ax, 0
  2719 00000F20 8B0E[FD1D]               mov cx, [tm_mday]
  2720 00000F24 E85000                   call hex_to_bcd
  2721 00000F27 88C2                     mov dl, al
  2722                                  
  2723 00000F29 59                       pop cx
  2724 00000F2A 58                       pop ax
  2725 00000F2B 5B                       pop bx
  2726 00000F2C 07                       pop es
  2727 00000F2D 1F                       pop ds
  2728                                  
  2729 00000F2E E92102                   jmp reach_stack_clc
  2730                                  
  2731                                   int1a_init:
  2732                                  
  2733 00000F31 E91E02                   jmp reach_stack_clc
  2734                                  
  2735                                  
  2736                                  
  2737                                  int1c:
  2738                                  
  2739 00000F34 CF                       iret
  2740                                  
  2741                                  
  2742                                  
  2743                                  int1e:
  2744                                  
  2745 00000F35 DF                       db 0xdf
  2746 00000F36 02                       db 0x02
  2747 00000F37 25                       db 0x25
  2748 00000F38 02                       db 0x02
  2749 00000F39 12                      int1e_spt db 18
  2750 00000F3A 1B                       db 0x1B
  2751 00000F3B FF                       db 0xFF
  2752 00000F3C 54                       db 0x54
  2753 00000F3D F6                       db 0xF6
  2754 00000F3E 0F                       db 0x0F
  2755 00000F3F 08                       db 0x08
  2756                                  
  2757                                  
  2758                                  
  2759                                  int41:
  2760                                  
  2761 00000F40 0000                    int41_max_cyls dw 0
  2762 00000F42 00                      int41_max_heads db 0
  2763 00000F43 0000                     dw 0
  2764 00000F45 0000                     dw 0
  2765 00000F47 00                       db 0
  2766 00000F48 C0                       db 11000000b
  2767 00000F49 00                       db 0
  2768 00000F4A 00                       db 0
  2769 00000F4B 00                       db 0
  2770 00000F4C 0000                     dw 0
  2771 00000F4E 00                      int41_max_sect db 0
  2772 00000F4F 00                       db 0
  2773                                  
  2774                                  
  2775                                  
  2776 00000F50 1000                    rom_config dw 16
  2777 00000F52 FE                       db 0xfe
  2778 00000F53 41                       db 'A'
  2779 00000F54 43                       db 'C'
  2780 00000F55 20                       db 0b00100000
  2781 00000F56 00                       db 0b00000000
  2782 00000F57 00                       db 0b00000000
  2783 00000F58 00                       db 0b00000000
  2784 00000F59 00                       db 0b00000000
  2785 00000F5A 000000000000             db 0, 0, 0, 0, 0, 0
  2786                                  
  2787                                  
  2788                                  
  2789 00000F60 0000                    num_disks dw 0
  2790 00000F62 0000                    hd_secs_hi dw 0
  2791 00000F64 0000                    hd_secs_lo dw 0
  2792 00000F66 0000                    hd_max_sector dw 0
  2793 00000F68 0000                    hd_max_track dw 0
  2794 00000F6A 0000                    hd_max_head dw 0
  2795 00000F6C 0000                    drive_tracks_temp dw 0
  2796 00000F6E 0000                    drive_sectors_temp dw 0
  2797 00000F70 0000                    drive_heads_temp dw 0
  2798 00000F72 0000                    drive_num_temp dw 0
  2799 00000F74 00                      boot_state db 0
  2800 00000F75 00                      cga_refresh_reg db 0
  2801                                  
  2802                                  
  2803                                  
  2804                                  int0:
  2805                                  int1:
  2806                                  int2:
  2807                                  int3:
  2808                                  int4:
  2809                                  int5:
  2810                                  int6:
  2811                                  intb:
  2812                                  intc:
  2813                                  intd:
  2814                                  inte:
  2815                                  intf:
  2816                                  int18:
  2817                                  int1b:
  2818                                  int1d:
  2819                                  
  2820 00000F76 CF                      iret
  2821                                  
  2822                                  
  2823                                  
  2824                                  
  2825                                  
  2826                                  hex_to_bcd:
  2827                                  
  2828 00000F77 53                       push bx
  2829                                  
  2830 00000F78 E32A                     jcxz h2bfin
  2831                                  
  2832                                   h2bloop:
  2833                                  
  2834 00000F7A 40                       inc ax
  2835                                  
  2836                                  
  2837 00000F7B 88C7                     mov bh, al
  2838 00000F7D 80E70F                   and bh, 0x0f
  2839 00000F80 80FF0A                   cmp bh, 0x0a
  2840 00000F83 7503                     jne c1
  2841 00000F85 83C006                   add ax, 0x0006
  2842                                  
  2843                                  
  2844                                   c1:
  2845 00000F88 88C7                     mov bh, al
  2846 00000F8A 80E7F0                   and bh, 0xf0
  2847 00000F8D 80FFA0                   cmp bh, 0xa0
  2848 00000F90 7503                     jne c2
  2849 00000F92 83C060                   add ax, 0x0060
  2850                                  
  2851                                  
  2852                                   c2:
  2853 00000F95 88E7                     mov bh, ah
  2854 00000F97 80E70F                   and bh, 0x0f
  2855 00000F9A 80FF0A                   cmp bh, 0x0a
  2856 00000F9D 7503                     jne c3
  2857 00000F9F 050006                   add ax, 0x0600
  2858                                  
  2859                                   c3:
  2860 00000FA2 E2D6                     loop h2bloop
  2861                                   h2bfin:
  2862 00000FA4 5B                       pop bx
  2863 00000FA5 C3                       ret
  2864                                  
  2865                                  
  2866                                  
  2867                                  puts_decimal_al:
  2868                                  
  2869 00000FA6 50                       push ax
  2870                                  
  2871 00000FA7 D40A                     aam
  2872 00000FA9 053030                   add ax, 0x3030
  2873                                  
  2874 00000FAC 80FC30                   cmp ah, 0x30
  2875 00000FAF 7406                     je pda_2nd
  2876                                  
  2877 00000FB1 86C4                     xchg ah, al
  2878                                  %line 15+1 bios.asm
    16 00000FB3 0F00                     db 0x0f, 0x00
    17                                  %line 2878+1 bios.asm
  2879 00000FB5 86C4                     xchg ah, al
  2880                                  
  2881                                   pda_2nd:
  2882                                  
  2883                                  %line 15+1 bios.asm
    16 00000FB7 0F00                     db 0x0f, 0x00
    17                                  %line 2883+1 bios.asm
  2884                                  
  2885 00000FB9 58                       pop ax
  2886 00000FBA C3                       ret
  2887                                  
  2888                                  
  2889                                  
  2890                                  
  2891                                  kb_adjust_buf:
  2892                                  
  2893 00000FBB 50                       push ax
  2894 00000FBC 53                       push bx
  2895                                  
  2896                                  
  2897                                  
  2898                                  
  2899 00000FBD 26A18200                 mov ax, [es:kbbuf_end_ptr-bios_data]
  2900 00000FC1 2639061A00               cmp [es:kbbuf_head-bios_data], ax
  2901 00000FC6 7C0A                     jnge kb_adjust_tail
  2902                                  
  2903 00000FC8 268B1E8000               mov bx, [es:kbbuf_start_ptr-bios_data]
  2904 00000FCD 26891E1A00               mov [es:kbbuf_head-bios_data], bx
  2905                                  
  2906                                   kb_adjust_tail:
  2907                                  
  2908                                  
  2909                                  
  2910                                  
  2911 00000FD2 26A18200                 mov ax, [es:kbbuf_end_ptr-bios_data]
  2912 00000FD6 2639061C00               cmp [es:kbbuf_tail-bios_data], ax
  2913 00000FDB 7C0A                     jnge kb_adjust_done
  2914                                  
  2915 00000FDD 268B1E8000               mov bx, [es:kbbuf_start_ptr-bios_data]
  2916 00000FE2 26891E1C00               mov [es:kbbuf_tail-bios_data], bx
  2917                                  
  2918                                   kb_adjust_done:
  2919                                  
  2920 00000FE7 5B                       pop bx
  2921 00000FE8 58                       pop ax
  2922 00000FE9 C3                       ret
  2923                                  
  2924                                  
  2925                                  
  2926                                  
  2927                                  
  2928                                  
  2929                                  chs_to_abs:
  2930                                  
  2931 00000FEA 50                       push ax
  2932 00000FEB 53                       push bx
  2933 00000FEC 51                       push cx
  2934 00000FED 52                       push dx
  2935                                  
  2936 00000FEE 2E8816[720F]             mov [cs:drive_num_temp], dl
  2937                                  
  2938                                  
  2939                                  
  2940 00000FF3 51                       push cx
  2941 00000FF4 88CF                     mov bh, cl
  2942 00000FF6 B106                     mov cl, 6
  2943 00000FF8 D2EF                     shr bh, cl
  2944 00000FFA 88EB                     mov bl, ch
  2945                                  
  2946                                  
  2947                                  
  2948 00000FFC 2E803E[720F]01           cmp byte [cs:drive_num_temp], 1
  2949                                  
  2950 00001002 52                       push dx
  2951                                  
  2952 00001003 BA0000                   mov dx, 0
  2953 00001006 93                       xchg ax, bx
  2954                                  
  2955 00001007 7510                     jne chs_hd
  2956                                  
  2957 00001009 D1E0                     shl ax, 1
  2958 0000100B 50                       push ax
  2959 0000100C 31C0                     xor ax, ax
  2960 0000100E 2EA0[390F]               mov al, [cs:int1e_spt]
  2961 00001012 2EA3[6E0F]               mov [cs:drive_sectors_temp], ax
  2962 00001016 58                       pop ax
  2963                                  
  2964 00001017 EB1A                     jmp chs_continue
  2965                                  
  2966                                  chs_hd:
  2967                                  
  2968 00001019 2E8B2E[6A0F]             mov bp, [cs:hd_max_head]
  2969 0000101E 45                       inc bp
  2970 0000101F 2E892E[700F]             mov [cs:drive_heads_temp], bp
  2971                                  
  2972 00001024 2EF726[700F]             mul word [cs:drive_heads_temp]
  2973                                  
  2974 00001029 2E8B2E[660F]             mov bp, [cs:hd_max_sector]
  2975 0000102E 2E892E[6E0F]             mov [cs:drive_sectors_temp], bp
  2976                                  
  2977                                  chs_continue:
  2978                                  
  2979 00001033 93                       xchg ax, bx
  2980                                  
  2981 00001034 5A                       pop dx
  2982                                  
  2983 00001035 86D6                     xchg dh, dl
  2984 00001037 B600                     mov dh, 0
  2985 00001039 01D3                     add bx, dx
  2986                                  
  2987 0000103B 2EA1[6E0F]               mov ax, [cs:drive_sectors_temp]
  2988 0000103F F7E3                     mul bx
  2989                                  
  2990                                  
  2991                                  
  2992 00001041 59                       pop cx
  2993 00001042 B500                     mov ch, 0
  2994 00001044 80E13F                   and cl, 0x3F
  2995 00001047 FEC9                     dec cl
  2996                                  
  2997 00001049 01C8                     add ax, cx
  2998 0000104B 83D200                   adc dx, 0
  2999 0000104E 89C5                     mov bp, ax
  3000 00001050 89D6                     mov si, dx
  3001                                  
  3002                                  
  3003                                  
  3004 00001052 5A                       pop dx
  3005 00001053 59                       pop cx
  3006 00001054 5B                       pop bx
  3007 00001055 58                       pop ax
  3008 00001056 C3                       ret
  3009                                  
  3010                                  
  3011                                  
  3012                                  clear_screen:
  3013                                  
  3014 00001057 50                       push ax
  3015                                  
  3016 00001058 B01B                     mov al, 0x1B
  3017                                  %line 15+1 bios.asm
    16 0000105A 0F00                     db 0x0f, 0x00
    17                                  %line 3017+1 bios.asm
  3018 0000105C B05B                     mov al, '['
  3019                                  %line 15+1 bios.asm
    16 0000105E 0F00                     db 0x0f, 0x00
    17                                  %line 3019+1 bios.asm
  3020 00001060 B072                     mov al, 'r'
  3021                                  %line 15+1 bios.asm
    16 00001062 0F00                     db 0x0f, 0x00
    17                                  %line 3021+1 bios.asm
  3022                                  
  3023 00001064 B01B                     mov al, 0x1B
  3024                                  %line 15+1 bios.asm
    16 00001066 0F00                     db 0x0f, 0x00
    17                                  %line 3024+1 bios.asm
  3025 00001068 B05B                     mov al, '['
  3026                                  %line 15+1 bios.asm
    16 0000106A 0F00                     db 0x0f, 0x00
    17                                  %line 3026+1 bios.asm
  3027 0000106C B030                     mov al, '0'
  3028                                  %line 15+1 bios.asm
    16 0000106E 0F00                     db 0x0f, 0x00
    17                                  %line 3028+1 bios.asm
  3029 00001070 B06D                     mov al, 'm'
  3030                                  %line 15+1 bios.asm
    16 00001072 0F00                     db 0x0f, 0x00
    17                                  %line 3030+1 bios.asm
  3031                                  
  3032 00001074 53                       push bx
  3033 00001075 51                       push cx
  3034 00001076 55                       push bp
  3035 00001077 50                       push ax
  3036 00001078 06                       push es
  3037                                  
  3038 00001079 89DD                     mov bp, bx
  3039 0000107B B10C                     mov cl, 12
  3040 0000107D D3CD                     ror bp, cl
  3041 0000107F 83E507                   and bp, 7
  3042 00001082 2E8A9E[5516]             mov bl, byte [cs:bp+colour_table]
  3043 00001087 80C30A                   add bl, 10
  3044                                  
  3045 0000108A B01B                     mov al, 0x1B
  3046                                  %line 15+1 bios.asm
    16 0000108C 0F00                     db 0x0f, 0x00
    17                                  %line 3046+1 bios.asm
  3047 0000108E B05B                     mov al, '['
  3048                                  %line 15+1 bios.asm
    16 00001090 0F00                     db 0x0f, 0x00
    17                                  %line 3048+1 bios.asm
  3049 00001092 88D8                     mov al, bl
  3050 00001094 E80FFF                   call puts_decimal_al
  3051 00001097 B06D                     mov al, 'm'
  3052                                  %line 15+1 bios.asm
    16 00001099 0F00                     db 0x0f, 0x00
    17                                  %line 3052+1 bios.asm
  3053                                  
  3054 0000109B B84000                   mov ax, 0x40
  3055 0000109E 8EC0                     mov es, ax
  3056 000010A0 26C606500000             mov byte [es:curpos_x-bios_data], 0
  3057 000010A6 26C6069D0000             mov byte [es:crt_curpos_x-bios_data], 0
  3058 000010AC 26C606510000             mov byte [es:curpos_y-bios_data], 0
  3059 000010B2 26C6069E0000             mov byte [es:crt_curpos_y-bios_data], 0
  3060                                  
  3061 000010B8 07                       pop es
  3062 000010B9 58                       pop ax
  3063 000010BA 5D                       pop bp
  3064 000010BB 59                       pop cx
  3065 000010BC 5B                       pop bx
  3066                                  
  3067 000010BD B01B                     mov al, 0x1B
  3068                                  %line 15+1 bios.asm
    16 000010BF 0F00                     db 0x0f, 0x00
    17                                  %line 3068+1 bios.asm
  3069 000010C1 B05B                     mov al, '['
  3070                                  %line 15+1 bios.asm
    16 000010C3 0F00                     db 0x0f, 0x00
    17                                  %line 3070+1 bios.asm
  3071 000010C5 B032                     mov al, '2'
  3072                                  %line 15+1 bios.asm
    16 000010C7 0F00                     db 0x0f, 0x00
    17                                  %line 3072+1 bios.asm
  3073 000010C9 B04A                     mov al, 'J'
  3074                                  %line 15+1 bios.asm
    16 000010CB 0F00                     db 0x0f, 0x00
    17                                  %line 3074+1 bios.asm
  3075                                  
  3076 000010CD B01B                     mov al, 0x1B
  3077                                  %line 15+1 bios.asm
    16 000010CF 0F00                     db 0x0f, 0x00
    17                                  %line 3077+1 bios.asm
  3078 000010D1 B05B                     mov al, '['
  3079                                  %line 15+1 bios.asm
    16 000010D3 0F00                     db 0x0f, 0x00
    17                                  %line 3079+1 bios.asm
  3080 000010D5 B031                     mov al, '1'
  3081                                  %line 15+1 bios.asm
    16 000010D7 0F00                     db 0x0f, 0x00
    17                                  %line 3081+1 bios.asm
  3082 000010D9 B03B                     mov al, ';'
  3083                                  %line 15+1 bios.asm
    16 000010DB 0F00                     db 0x0f, 0x00
    17                                  %line 3083+1 bios.asm
  3084 000010DD B031                     mov al, '1'
  3085                                  %line 15+1 bios.asm
    16 000010DF 0F00                     db 0x0f, 0x00
    17                                  %line 3085+1 bios.asm
  3086 000010E1 B048                     mov al, 'H'
  3087                                  %line 15+1 bios.asm
    16 000010E3 0F00                     db 0x0f, 0x00
    17                                  %line 3087+1 bios.asm
  3088                                  
  3089 000010E5 06                       push es
  3090 000010E6 57                       push di
  3091 000010E7 51                       push cx
  3092                                  
  3093 000010E8 FC                       cld
  3094 000010E9 B800B8                   mov ax, 0xb800
  3095 000010EC 8EC0                     mov es, ax
  3096 000010EE BF0000                   mov di, 0
  3097 000010F1 B000                     mov al, 0
  3098 000010F3 88FC                     mov ah, bh
  3099 000010F5 B9D007                   mov cx, 80*25
  3100 000010F8 F3AB                     rep stosw
  3101                                  
  3102 000010FA FC                       cld
  3103 000010FB BF00C8                   mov di, 0xc800
  3104 000010FE 8EC7                     mov es, di
  3105 00001100 BF0000                   mov di, 0
  3106 00001103 B9D007                   mov cx, 80*25
  3107 00001106 F3AB                     rep stosw
  3108                                  
  3109 00001108 FC                       cld
  3110 00001109 BF00C0                   mov di, 0xc000
  3111 0000110C 8EC7                     mov es, di
  3112 0000110E BF0000                   mov di, 0
  3113 00001111 B9D007                   mov cx, 80*25
  3114 00001114 F3AB                     rep stosw
  3115                                  
  3116 00001116 59                       pop cx
  3117 00001117 5F                       pop di
  3118 00001118 07                       pop es
  3119                                  
  3120 00001119 58                       pop ax
  3121                                  
  3122 0000111A 2EC606[8716]01           mov byte [cs:vram_dirty], 1
  3123                                  
  3124 00001120 C3                       ret
  3125                                  
  3126                                  
  3127                                  
  3128                                  
  3129                                  keypress_release:
  3130                                  
  3131 00001121 50                       push ax
  3132                                  
  3133 00001122 26803E9F0000             cmp byte [es:key_now_down-bios_data], 0
  3134 00001128 740B                     je kpr_no_prev_release
  3135                                  
  3136 0000112A 26A09F00                 mov al, [es:key_now_down-bios_data]
  3137 0000112E 0480                     add al, 0x80
  3138 00001130 E80B00                   call io_key_available
  3139                                  
  3140 00001133 58                       pop ax
  3141 00001134 50                       push ax
  3142                                  
  3143                                   kpr_no_prev_release:
  3144                                  
  3145 00001135 26A29F00                 mov [es:key_now_down-bios_data], al
  3146 00001139 E80200                   call io_key_available
  3147                                  
  3148 0000113C 58                       pop ax
  3149                                  
  3150 0000113D C3                       ret
  3151                                  
  3152                                  
  3153                                  
  3154                                  io_key_available:
  3155                                  
  3156 0000113E 50                       push ax
  3157 0000113F B001                     mov al, 1
  3158 00001141 E664                     out 0x64, al
  3159 00001143 58                       pop ax
  3160                                  
  3161 00001144 E660                     out 0x60, al
  3162 00001146 CD09                     int 9
  3163 00001148 C3                       ret
  3164                                  
  3165                                  
  3166                                  
  3167                                  reach_stack_stc:
  3168                                  
  3169 00001149 87E5                     xchg bp, sp
  3170 0000114B 834E0401                 or word [bp+4], 1
  3171 0000114F 87E5                     xchg bp, sp
  3172 00001151 CF                       iret
  3173                                  
  3174                                  
  3175                                  
  3176                                  reach_stack_clc:
  3177                                  
  3178 00001152 87E5                     xchg bp, sp
  3179 00001154 836604FE                 and word [bp+4], 0xfffe
  3180 00001158 87E5                     xchg bp, sp
  3181 0000115A CF                       iret
  3182                                  
  3183                                  
  3184                                  
  3185                                  
  3186                                  reach_stack_carry:
  3187                                  
  3188 0000115B 72EC                     jc reach_stack_stc
  3189 0000115D EBF3                     jmp reach_stack_clc
  3190                                  
  3191                                  
  3192                                  
  3193                                  
  3194                                  
  3195                                  
  3196                                  
  3197                                  
  3198                                  
  3199                                  vmem_driver_entry:
  3200                                  
  3201 0000115F 2E803E[8616]01           cmp byte [cs:in_update], 1
  3202 00001165 741B                     je just_finish
  3203                                  
  3204 00001167 2EFE06[8516]             inc byte [cs:int8_ctr]
  3205 0000116C 2E803E[8516]08           cmp byte [cs:int8_ctr], 8
  3206 00001172 750E                     jne just_finish
  3207                                  
  3208                                  gmode_test:
  3209                                  
  3210 00001174 2EC606[8516]00           mov byte [cs:int8_ctr], 0
  3211 0000117A BAB803                   mov dx, 0x3b8
  3212 0000117D EC                       in al, dx
  3213 0000117E A802                     test al, 2
  3214 00001180 7401                     jz vram_zero_check
  3215                                  
  3216                                  just_finish:
  3217                                  
  3218 00001182 C3                       ret
  3219                                  
  3220                                  vram_zero_check:
  3221                                  
  3222 00001183 2EC606[8616]01           mov byte [cs:in_update], 1
  3223                                  
  3224 00001189 FB                       sti
  3225                                  
  3226 0000118A BB4000                   mov bx, 0x40
  3227 0000118D 8EDB                     mov ds, bx
  3228                                  
  3229 0000118F 8B3EAD00                 mov di, [vmem_offset-bios_data]
  3230 00001193 D1E7                     shl di, 1
  3231 00001195 57                       push di
  3232                                  
  3233 00001196 BB00B8                   mov bx, 0xb800
  3234 00001199 8EC3                     mov es, bx
  3235 0000119B B9D007                   mov cx, 0x7d0
  3236 0000119E B80007                   mov ax, 0x0700
  3237                                  
  3238 000011A1 FC                       cld
  3239 000011A2 F3AF                     repz scasw
  3240 000011A4 5F                       pop di
  3241 000011A5 7503E9F101               je vmem_done
  3242                                  
  3243 000011AA 2E803E[8716]01           cmp byte [cs:vram_dirty], 1
  3244 000011B0 7434                     je vram_update
  3245                                  
  3246 000011B2 BB00C8                   mov bx, 0xc800
  3247 000011B5 8EDB                     mov ds, bx
  3248 000011B7 BE0000                   mov si, 0
  3249 000011BA B9D007                   mov cx, 0x7d0
  3250                                  
  3251 000011BD FC                       cld
  3252 000011BE F3A7                     repz cmpsw
  3253 000011C0 7524                     jne vram_update
  3254                                  
  3255 000011C2 BB4000                   mov bx, 0x40
  3256 000011C5 8EDB                     mov ds, bx
  3257 000011C7 8A3E9E00                 mov bh, [crt_curpos_y-bios_data]
  3258 000011CB 8A1E9D00                 mov bl, [crt_curpos_x-bios_data]
  3259                                  
  3260 000011CF 2E3A3E[8C16]             cmp bh, [cs:crt_curpos_y_last]
  3261 000011D4 7403E97401               jne restore_cursor
  3262 000011D9 2E3A1E[8B16]             cmp bl, [cs:crt_curpos_x_last]
  3263 000011DE 7403E96A01               jne restore_cursor
  3264                                  
  3265 000011E3 E9B501                   jmp vmem_done
  3266                                  
  3267                                  vram_update:
  3268                                  
  3269 000011E6 BB4000                   mov bx, 0x40
  3270 000011E9 8EC3                     mov es, bx
  3271                                  
  3272 000011EB 0E                       push cs
  3273 000011EC 1F                       pop ds
  3274                                  
  3275 000011ED C606[8916]FF             mov byte [int_curpos_x], 0xff
  3276 000011F2 C606[8A16]FF             mov byte [int_curpos_y], 0xff
  3277                                  
  3278 000011F7 26803EA10000             cmp byte [es:cursor_visible-bios_data], 0
  3279 000011FD 7403                     je dont_hide_cursor
  3280                                  
  3281 000011FF E8BF01                   call ansi_hide_cursor
  3282                                  
  3283                                  dont_hide_cursor:
  3284                                  
  3285 00001202 C606[8816]FF             mov byte [last_attrib], 0xff
  3286                                  
  3287 00001207 BB4000                   mov bx, 0x40
  3288 0000120A 8EC3                     mov es, bx
  3289                                  
  3290 0000120C 268B3EAD00               mov di, [es:vmem_offset-bios_data]
  3291 00001211 D1E7                     shl di, 1
  3292 00001213 83EF02                   sub di, 2
  3293                                  
  3294 00001216 BB00B8                   mov bx, 0xb800
  3295 00001219 8EC3                     mov es, bx
  3296                                  
  3297                                  
  3298                                  
  3299                                  
  3300 0000121B BDFFFF                   mov bp, -1
  3301 0000121E BE4F00                   mov si, 79
  3302                                  
  3303                                  disp_loop:
  3304                                  
  3305                                  
  3306                                  
  3307 00001221 83C702                   add di, 2
  3308 00001224 46                       inc si
  3309 00001225 83FE50                   cmp si, 80
  3310 00001228 7571                     jne cont
  3311                                  
  3312                                  
  3313                                  
  3314                                  loop_next_line:
  3315                                  
  3316 0000122A BE0000                   mov si, 0
  3317 0000122D 45                       inc bp
  3318                                  
  3319                                  
  3320                                  
  3321 0000122E 83FD19                   cmp bp, 25
  3322 00001231 7503E90701               je restore_attrib
  3323                                  
  3324                                  
  3325                                  
  3326 00001236 2E803E[8716]01           cmp byte [cs:vram_dirty], 1
  3327 0000123C 745D                     je cont
  3328                                  
  3329 0000123E 56                       push si
  3330 0000123F 57                       push di
  3331                                  
  3332 00001240 BB00B8                   mov bx, 0xb800
  3333 00001243 8EDB                     mov ds, bx
  3334 00001245 BB00C8                   mov bx, 0xc800
  3335 00001248 8EC3                     mov es, bx
  3336 0000124A 89FE                     mov si, di
  3337                                  
  3338 0000124C 06                       push es
  3339 0000124D BB4000                   mov bx, 0x40
  3340 00001250 8EC3                     mov es, bx
  3341 00001252 262B3EAD00               sub di, [es:vmem_offset-bios_data]
  3342 00001257 262B3EAD00               sub di, [es:vmem_offset-bios_data]
  3343 0000125C 07                       pop es
  3344                                  
  3345 0000125D B95000                   mov cx, 80
  3346                                  
  3347 00001260 FC                       cld
  3348 00001261 F3A7                     repz cmpsw
  3349 00001263 5F                       pop di
  3350 00001264 5E                       pop si
  3351                                  
  3352 00001265 742E                     je vmem_next_line
  3353                                  
  3354                                  vmem_copy_buf:
  3355                                  
  3356                                  
  3357                                  
  3358 00001267 51                       push cx
  3359 00001268 56                       push si
  3360 00001269 57                       push di
  3361                                  
  3362 0000126A 06                       push es
  3363 0000126B BB4000                   mov bx, 0x40
  3364 0000126E 8EC3                     mov es, bx
  3365 00001270 89FE                     mov si, di
  3366 00001272 262B3EAD00               sub di, [es:vmem_offset-bios_data]
  3367 00001277 262B3EAD00               sub di, [es:vmem_offset-bios_data]
  3368 0000127C 07                       pop es
  3369                                  
  3370 0000127D B95000                   mov cx, 80
  3371 00001280 FC                       cld
  3372 00001281 F3A5                     rep movsw
  3373                                  
  3374 00001283 5F                       pop di
  3375 00001284 5E                       pop si
  3376 00001285 59                       pop cx
  3377                                  
  3378                                  
  3379                                  
  3380 00001286 BB4F00                   mov bx, 79
  3381 00001289 29CB                     sub bx, cx
  3382                                  
  3383 0000128B 01DF                     add di, bx
  3384 0000128D 01DF                     add di, bx
  3385 0000128F 01DE                     add si, bx
  3386                                  
  3387 00001291 1E                       push ds
  3388 00001292 07                       pop es
  3389                                  
  3390 00001293 EB06                     jmp cont
  3391                                  
  3392                                  vmem_next_line:
  3393                                  
  3394 00001295 81C7A000                 add di, 160
  3395 00001299 EB8F                     jmp loop_next_line
  3396                                  
  3397                                  cont:
  3398 0000129B 0E                       push cs
  3399 0000129C 1F                       pop ds
  3400                                  
  3401 0000129D 26803D00                 cmp byte [es:di], 0
  3402 000012A1 7503E97BFF               je disp_loop
  3403                                  
  3404 000012A6 89E8                     mov ax, bp
  3405 000012A8 89F3                     mov bx, si
  3406 000012AA 88C6                     mov dh, al
  3407 000012AC 88DA                     mov dl, bl
  3408                                  
  3409 000012AE 3A36[8A16]               cmp dh, [int_curpos_y]
  3410 000012B2 750A                     jne ansi_set_cur_pos
  3411 000012B4 52                       push dx
  3412 000012B5 FECA                     dec dl
  3413 000012B7 3A16[8916]               cmp dl, [int_curpos_x]
  3414 000012BB 5A                       pop dx
  3415 000012BC 7422                     je skip_set_cur_pos
  3416                                  
  3417                                  ansi_set_cur_pos:
  3418                                  
  3419 000012BE B01B                     mov al, 0x1B
  3420                                  %line 15+1 bios.asm
    16 000012C0 0F00                     db 0x0f, 0x00
    17                                  %line 3420+1 bios.asm
  3421 000012C2 B05B                     mov al, '['
  3422                                  %line 15+1 bios.asm
    16 000012C4 0F00                     db 0x0f, 0x00
    17                                  %line 3422+1 bios.asm
  3423 000012C6 88F0                     mov al, dh
  3424 000012C8 FEC0                     inc al
  3425 000012CA E8D9FC                   call puts_decimal_al
  3426 000012CD B03B                     mov al, ';'
  3427                                  %line 15+1 bios.asm
    16 000012CF 0F00                     db 0x0f, 0x00
    17                                  %line 3427+1 bios.asm
  3428 000012D1 88D0                     mov al, dl
  3429 000012D3 FEC0                     inc al
  3430 000012D5 E8CEFC                   call puts_decimal_al
  3431 000012D8 B048                     mov al, 'H'
  3432                                  %line 15+1 bios.asm
    16 000012DA 0F00                     db 0x0f, 0x00
    17                                  %line 3432+1 bios.asm
  3433                                  
  3434 000012DC 8836[8A16]               mov [int_curpos_y], dh
  3435                                  
  3436                                  skip_set_cur_pos:
  3437                                  
  3438 000012E0 8816[8916]               mov [int_curpos_x], dl
  3439                                  
  3440 000012E4 268A5501                 mov dl, [es:di+1]
  3441 000012E8 3A16[8816]               cmp dl, [last_attrib]
  3442 000012EC 743E                     je skip_attrib
  3443                                  
  3444 000012EE 8816[8816]               mov [last_attrib], dl
  3445                                  
  3446 000012F2 B01B                     mov al, 0x1B
  3447                                  %line 15+1 bios.asm
    16 000012F4 0F00                     db 0x0f, 0x00
    17                                  %line 3447+1 bios.asm
  3448 000012F6 B05B                     mov al, '['
  3449                                  %line 15+1 bios.asm
    16 000012F8 0F00                     db 0x0f, 0x00
    17                                  %line 3449+1 bios.asm
  3450                                  
  3451 000012FA 88D0                     mov al, dl
  3452 000012FC 2408                     and al, 8
  3453                                  [cpu 186]
  3454 000012FE C0E803                   shr al, 3
  3455                                  [cpu 8086]
  3456                                  
  3457 00001301 E8A2FC                   call puts_decimal_al
  3458 00001304 B03B                     mov al, ';'
  3459                                  %line 15+1 bios.asm
    16 00001306 0F00                     db 0x0f, 0x00
    17                                  %line 3459+1 bios.asm
  3460                                  
  3461 00001308 52                       push dx
  3462                                  
  3463 00001309 80E207                   and dl, 7
  3464 0000130C BB[5516]                 mov bx, colour_table
  3465 0000130F 88D0                     mov al, dl
  3466 00001311 D7                       xlat
  3467                                  
  3468 00001312 E891FC                   call puts_decimal_al
  3469 00001315 B03B                     mov al, ';'
  3470                                  %line 15+1 bios.asm
    16 00001317 0F00                     db 0x0f, 0x00
    17                                  %line 3470+1 bios.asm
  3471                                  
  3472 00001319 5A                       pop dx
  3473                                  
  3474                                  [cpu 186]
  3475 0000131A C0EA04                   shr dl, 4
  3476                                  [cpu 8086]
  3477 0000131D 80E207                   and dl, 7
  3478                                  
  3479 00001320 88D0                     mov al, dl
  3480 00001322 D7                       xlat
  3481                                  
  3482 00001323 040A                     add al, 10
  3483 00001325 E87EFC                   call puts_decimal_al
  3484 00001328 B06D                     mov al, 'm'
  3485                                  %line 15+1 bios.asm
    16 0000132A 0F00                     db 0x0f, 0x00
    17                                  %line 3485+1 bios.asm
  3486                                  
  3487                                  skip_attrib:
  3488                                  
  3489 0000132C 268A05                   mov al, [es:di]
  3490                                  
  3491 0000132F 3C20                     cmp al, 32
  3492 00001331 7305                     jae just_show_it
  3493                                  
  3494 00001333 BB[5D16]                 mov bx, low_ascii_conv
  3495 00001336 2ED7                     cs xlat
  3496                                  
  3497                                  just_show_it:
  3498                                  
  3499                                  %line 15+1 bios.asm
    16 00001338 0F00                     db 0x0f, 0x00
    17                                  %line 3499+1 bios.asm
  3500                                  
  3501 0000133A E9E4FE                   jmp disp_loop
  3502                                  
  3503                                  restore_attrib:
  3504                                  
  3505 0000133D B01B                     mov al, 0x1B
  3506                                  %line 15+1 bios.asm
    16 0000133F 0F00                     db 0x0f, 0x00
    17                                  %line 3506+1 bios.asm
  3507 00001341 B05B                     mov al, '['
  3508                                  %line 15+1 bios.asm
    16 00001343 0F00                     db 0x0f, 0x00
    17                                  %line 3508+1 bios.asm
  3509 00001345 B030                     mov al, '0'
  3510                                  %line 15+1 bios.asm
    16 00001347 0F00                     db 0x0f, 0x00
    17                                  %line 3510+1 bios.asm
  3511 00001349 B06D                     mov al, 'm'
  3512                                  %line 15+1 bios.asm
    16 0000134B 0F00                     db 0x0f, 0x00
    17                                  %line 3512+1 bios.asm
  3513                                  
  3514                                  restore_cursor:
  3515                                  
  3516                                  
  3517                                  
  3518                                  
  3519                                  
  3520 0000134D BB4000                   mov bx, 0x40
  3521 00001350 8EDB                     mov ds, bx
  3522                                  
  3523 00001352 8A3E9E00                 mov bh, [crt_curpos_y-bios_data]
  3524 00001356 8A1E9D00                 mov bl, [crt_curpos_x-bios_data]
  3525 0000135A 2E883E[8C16]             mov [cs:crt_curpos_y_last], bh
  3526 0000135F 2E881E[8B16]             mov [cs:crt_curpos_x_last], bl
  3527                                  
  3528 00001364 80FF18                   cmp bh, 24
  3529 00001367 772F                     ja vmem_end_hidden_cursor
  3530 00001369 80FB4F                   cmp bl, 79
  3531 0000136C 772A                     ja vmem_end_hidden_cursor
  3532                                  
  3533 0000136E B01B                     mov al, 0x1B
  3534                                  %line 15+1 bios.asm
    16 00001370 0F00                     db 0x0f, 0x00
    17                                  %line 3534+1 bios.asm
  3535 00001372 B05B                     mov al, '['
  3536                                  %line 15+1 bios.asm
    16 00001374 0F00                     db 0x0f, 0x00
    17                                  %line 3536+1 bios.asm
  3537 00001376 88F8                     mov al, bh
  3538 00001378 FEC0                     inc al
  3539 0000137A E829FC                   call puts_decimal_al
  3540 0000137D B03B                     mov al, ';'
  3541                                  %line 15+1 bios.asm
    16 0000137F 0F00                     db 0x0f, 0x00
    17                                  %line 3541+1 bios.asm
  3542 00001381 88D8                     mov al, bl
  3543 00001383 FEC0                     inc al
  3544 00001385 E81EFC                   call puts_decimal_al
  3545 00001388 B048                     mov al, 'H'
  3546                                  %line 15+1 bios.asm
    16 0000138A 0F00                     db 0x0f, 0x00
    17                                  %line 3546+1 bios.asm
  3547                                  
  3548                                  restore_cursor_visible:
  3549                                  
  3550 0000138C 803EA10001               cmp byte [cursor_visible-bios_data], 1
  3551 00001391 7505                     jne vmem_end_hidden_cursor
  3552                                  
  3553 00001393 E81200                   call ansi_show_cursor
  3554 00001396 EB03                     jmp vmem_done
  3555                                  
  3556                                  vmem_end_hidden_cursor:
  3557                                  
  3558 00001398 E82600                   call ansi_hide_cursor
  3559                                  
  3560                                  vmem_done:
  3561                                  
  3562 0000139B 2EC606[8716]00           mov byte [cs:vram_dirty], 0
  3563 000013A1 2EC606[8616]00           mov byte [cs:in_update], 0
  3564 000013A7 C3                       ret
  3565                                  
  3566                                  
  3567                                  
  3568                                  ansi_show_cursor:
  3569                                  
  3570 000013A8 B01B                     mov al, 0x1B
  3571                                  %line 15+1 bios.asm
    16 000013AA 0F00                     db 0x0f, 0x00
    17                                  %line 3571+1 bios.asm
  3572 000013AC B05B                     mov al, '['
  3573                                  %line 15+1 bios.asm
    16 000013AE 0F00                     db 0x0f, 0x00
    17                                  %line 3573+1 bios.asm
  3574 000013B0 B03F                     mov al, '?'
  3575                                  %line 15+1 bios.asm
    16 000013B2 0F00                     db 0x0f, 0x00
    17                                  %line 3575+1 bios.asm
  3576 000013B4 B032                     mov al, '2'
  3577                                  %line 15+1 bios.asm
    16 000013B6 0F00                     db 0x0f, 0x00
    17                                  %line 3577+1 bios.asm
  3578 000013B8 B035                     mov al, '5'
  3579                                  %line 15+1 bios.asm
    16 000013BA 0F00                     db 0x0f, 0x00
    17                                  %line 3579+1 bios.asm
  3580 000013BC B068                     mov al, 'h'
  3581                                  %line 15+1 bios.asm
    16 000013BE 0F00                     db 0x0f, 0x00
    17                                  %line 3581+1 bios.asm
  3582                                  
  3583 000013C0 C3                       ret
  3584                                  
  3585                                  
  3586                                  
  3587                                  ansi_hide_cursor:
  3588                                  
  3589 000013C1 B01B                     mov al, 0x1B
  3590                                  %line 15+1 bios.asm
    16 000013C3 0F00                     db 0x0f, 0x00
    17                                  %line 3590+1 bios.asm
  3591 000013C5 B05B                     mov al, '['
  3592                                  %line 15+1 bios.asm
    16 000013C7 0F00                     db 0x0f, 0x00
    17                                  %line 3592+1 bios.asm
  3593 000013C9 B03F                     mov al, '?'
  3594                                  %line 15+1 bios.asm
    16 000013CB 0F00                     db 0x0f, 0x00
    17                                  %line 3594+1 bios.asm
  3595 000013CD B032                     mov al, '2'
  3596                                  %line 15+1 bios.asm
    16 000013CF 0F00                     db 0x0f, 0x00
    17                                  %line 3596+1 bios.asm
  3597 000013D1 B035                     mov al, '5'
  3598                                  %line 15+1 bios.asm
    16 000013D3 0F00                     db 0x0f, 0x00
    17                                  %line 3598+1 bios.asm
  3599 000013D5 B06C                     mov al, 'l'
  3600                                  %line 15+1 bios.asm
    16 000013D7 0F00                     db 0x0f, 0x00
    17                                  %line 3600+1 bios.asm
  3601                                  
  3602 000013D9 C3                       ret
  3603                                  
  3604                                  
  3605                                  
  3606                                  
  3607                                  
  3608                                  
  3609                                  
  3610                                  bios_data:
  3611                                  
  3612 000013DA 0000                    com1addr dw 0
  3613 000013DC 0000                    com2addr dw 0
  3614 000013DE 0000                    com3addr dw 0
  3615 000013E0 0000                    com4addr dw 0
  3616 000013E2 0000                    lpt1addr dw 0
  3617 000013E4 0000                    lpt2addr dw 0
  3618 000013E6 0000                    lpt3addr dw 0
  3619 000013E8 0000                    lpt4addr dw 0
  3620 000013EA 2100                    equip dw 0b0000000000100001
  3621                                  
  3622 000013EC 00                       db 0
  3623 000013ED 8002                    memsize dw 0x280
  3624 000013EF 00                       db 0
  3625 000013F0 00                       db 0
  3626 000013F1 00                      keyflags1 db 0
  3627 000013F2 00                      keyflags2 db 0
  3628 000013F3 00                       db 0
  3629 000013F4 1E00                    kbbuf_head dw kbbuf-bios_data
  3630 000013F6 1E00                    kbbuf_tail dw kbbuf-bios_data
  3631 000013F8 58<rep 20h>             kbbuf: times 32 db 'X'
  3632 00001418 00                      drivecal db 0
  3633 00001419 00                      diskmotor db 0
  3634 0000141A 07                      motorshutoff db 0x07
  3635 0000141B 00                      disk_laststatus db 0
  3636 0000141C 00<rep 7h>              times 7 db 0
  3637 00001423 03                      vidmode db 0x03
  3638 00001424 5000                    vid_cols dw 80
  3639 00001426 0010                    page_size dw 0x1000
  3640 00001428 0000                     dw 0
  3641 0000142A 00                      curpos_x db 0
  3642 0000142B 00                      curpos_y db 0
  3643 0000142C 0000<rep 7h>            times 7 dw 0
  3644 0000143A 07                      cur_v_end db 7
  3645 0000143B 06                      cur_v_start db 6
  3646 0000143C 00                      disp_page db 0
  3647 0000143D D403                    crtport dw 0x3d4
  3648 0000143F 0A                       db 10
  3649 00001440 00                       db 0
  3650 00001441 00<rep 5h>              times 5 db 0
  3651 00001446 00000000                clk_dtimer dd 0
  3652 0000144A 00                      clk_rollover db 0
  3653 0000144B 00                      ctrl_break db 0
  3654 0000144C 3412                    soft_rst_flg dw 0x1234
  3655 0000144E 00                       db 0
  3656 0000144F 00                      num_hd db 0
  3657 00001450 00                       db 0
  3658 00001451 00                       db 0
  3659 00001452 00000000                 dd 0
  3660 00001456 00000000                 dd 0
  3661 0000145A 1E00                    kbbuf_start_ptr dw 0x001e
  3662 0000145C 3E00                    kbbuf_end_ptr dw 0x003e
  3663 0000145E 19                      vid_rows db 25
  3664 0000145F 00                       db 0
  3665 00001460 00                       db 0
  3666 00001461 00                      vidmode_opt db 0
  3667 00001462 00                       db 0
  3668 00001463 00                       db 0
  3669 00001464 00                       db 0
  3670 00001465 00                       db 0
  3671 00001466 00                       db 0
  3672 00001467 00                       db 0
  3673 00001468 00                       db 0
  3674 00001469 00                       db 0
  3675 0000146A 00                       db 0
  3676 0000146B 00                       db 0
  3677 0000146C 00                       db 0
  3678 0000146D 00                       db 0
  3679 0000146E 00                       db 0
  3680 0000146F 00                       db 0
  3681 00001470 00                      kb_mode db 0
  3682 00001471 00                      kb_led db 0
  3683 00001472 00                       db 0
  3684 00001473 00                       db 0
  3685 00001474 00                       db 0
  3686 00001475 00                       db 0
  3687 00001476 00                      boot_device db 0
  3688 00001477 00                      crt_curpos_x db 0
  3689 00001478 00                      crt_curpos_y db 0
  3690 00001479 00                      key_now_down db 0
  3691 0000147A 00                      next_key_fn db 0
  3692 0000147B 01                      cursor_visible db 1
  3693 0000147C 00                      escape_flag_last db 0
  3694 0000147D 00                      next_key_alt db 0
  3695 0000147E 00                      escape_flag db 0
  3696 0000147F 00                      notranslate_flg db 0
  3697 00001480 00                      this_keystroke db 0
  3698 00001481 00                      this_keystroke_ext db 0
  3699 00001482 FFFF                    timer0_freq dw 0xffff
  3700 00001484 0000                    timer2_freq dw 0
  3701 00001486 00                      cga_vmode db 0
  3702 00001487 0000                    vmem_offset dw 0
  3703 00001489 00<rep 50h>             ending: times (0xff-($-com1addr)) db 0
  3704                                  
  3705                                  
  3706                                  
  3707 000014D9 FF1E302E201221220E-     a2scan_tbl db 0xFF, 0x1E, 0x30, 0x2E, 0x20, 0x12, 0x21, 0x22, 0x0E, 0x0F, 0x24, 0x25, 0x26, 0x1C, 0x31, 0x18, 0x19, 0x10, 0x13, 0x1F, 0x14, 0x16, 0x2F, 0x11, 0x2D, 0x15, 0x2C, 0x01, 0x00, 0x00, 0x00, 0x00, 0x39, 0x02, 0x28, 0x04, 0x05, 0x06, 0x08, 0x28, 0x0A, 0x0B, 0x09, 0x0D, 0x33, 0x0C, 0x34, 0x35, 0x0B, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x27, 0x27, 0x33, 0x0D, 0x34, 0x35, 0x03, 0x1E, 0x30, 0x2E, 0x20, 0x12, 0x21, 0x22, 0x23, 0x17, 0x24, 0x25, 0x26, 0x32, 0x31, 0x18, 0x19, 0x10, 0x13, 0x1F, 0x14, 0x16, 0x2F, 0x11, 0x2D, 0x15, 0x2C, 0x1A, 0x2B, 0x1B, 0x07, 0x0C, 0x29, 0x1E, 0x30, 0x2E, 0x20, 0x12, 0x21, 0x22, 0x23, 0x17, 0x24, 0x25, 0x26, 0x32, 0x31, 0x18, 0x19, 0x10, 0x13, 0x1F, 0x14, 0x16, 0x2F, 0x11, 0x2D, 0x15, 0x2C, 0x1A, 0x2B, 0x1B, 0x29, 0x0E
  3707 000014E2 0F2425261C31181910-
  3707 000014EB 131F14162F112D152C-
  3707 000014F4 010000000039022804-
  3707 000014FD 050608280A0B090D33-
  3707 00001506 0C34350B0203040506-
  3707 0000150F 0708090A2727330D34-
  3707 00001518 35031E302E20122122-
  3707 00001521 231724252632311819-
  3707 0000152A 10131F14162F112D15-
  3707 00001533 2C1A2B1B070C291E30-
  3707 0000153C 2E2012212223172425-
  3707 00001545 263231181910131F14-
  3707 0000154E 162F112D152C1A2B1B-
  3707 00001557 290E               
  3708 00001559 000000000000000000-     a2shift_tbl db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0
  3708 00001562 000000000000000000-
  3708 0000156B 000000000000000000-
  3708 00001574 000000000000010101-
  3708 0000157D 010101000101010100-
  3708 00001586 000000000000000000-
  3708 0000158F 000000000100010001-
  3708 00001598 010101010101010101-
  3708 000015A1 010101010101010101-
  3708 000015AA 010101010101010101-
  3708 000015B3 010000000101000000-
  3708 000015BC 000000000000000000-
  3708 000015C5 000000000000000000-
  3708 000015CE 000000000000010101-
  3708 000015D7 0100               
  3709                                  
  3710                                  
  3711                                  
  3712 000015D9 [760F]                  int_table dw int0
  3713 000015DB 00F0                     dw 0xf000
  3714 000015DD [760F]                   dw int1
  3715 000015DF 00F0                     dw 0xf000
  3716 000015E1 [760F]                   dw int2
  3717 000015E3 00F0                     dw 0xf000
  3718 000015E5 [760F]                   dw int3
  3719 000015E7 00F0                     dw 0xf000
  3720 000015E9 [760F]                   dw int4
  3721 000015EB 00F0                     dw 0xf000
  3722 000015ED [760F]                   dw int5
  3723 000015EF 00F0                     dw 0xf000
  3724 000015F1 [760F]                   dw int6
  3725 000015F3 00F0                     dw 0xf000
  3726 000015F5 [3202]                   dw int7
  3727 000015F7 00F0                     dw 0xf000
  3728 000015F9 [3F06]                   dw int8
  3729 000015FB 00F0                     dw 0xf000
  3730 000015FD [3D05]                   dw int9
  3731 000015FF 00F0                     dw 0xf000
  3732 00001601 [7D05]                   dw inta
  3733 00001603 00F0                     dw 0xf000
  3734 00001605 [760F]                   dw intb
  3735 00001607 00F0                     dw 0xf000
  3736 00001609 [760F]                   dw intc
  3737 0000160B 00F0                     dw 0xf000
  3738 0000160D [760F]                   dw intd
  3739 0000160F 00F0                     dw 0xf000
  3740 00001611 [760F]                   dw inte
  3741 00001613 00F0                     dw 0xf000
  3742 00001615 [760F]                   dw intf
  3743 00001617 00F0                     dw 0xf000
  3744 00001619 [4206]                   dw int10
  3745 0000161B 00F0                     dw 0xf000
  3746 0000161D [A60B]                   dw int11
  3747 0000161F 00F0                     dw 0xf000
  3748 00001621 [AB0B]                   dw int12
  3749 00001623 00F0                     dw 0xf000
  3750 00001625 [AF0B]                   dw int13
  3751 00001627 00F0                     dw 0xf000
  3752 00001629 [990D]                   dw int14
  3753 0000162B 00F0                     dw 0xf000
  3754 0000162D [A70D]                   dw int15
  3755 0000162F 00F0                     dw 0xf000
  3756 00001631 [AC0D]                   dw int16
  3757 00001633 00F0                     dw 0xf000
  3758 00001635 [310E]                   dw int17
  3759 00001637 00F0                     dw 0xf000
  3760 00001639 [760F]                   dw int18
  3761 0000163B 00F0                     dw 0xf000
  3762 0000163D [3E0E]                   dw int19
  3763 0000163F 00F0                     dw 0xf000
  3764 00001641 [410E]                   dw int1a
  3765 00001643 00F0                     dw 0xf000
  3766 00001645 [760F]                   dw int1b
  3767 00001647 00F0                     dw 0xf000
  3768 00001649 [340F]                   dw int1c
  3769 0000164B 00F0                     dw 0xf000
  3770 0000164D [760F]                   dw int1d
  3771 0000164F 00F0                     dw 0xf000
  3772 00001651 [350F]                   dw int1e
  3773                                  
  3774 00001653 7A00                    itbl_size dw $-int_table
  3775                                  
  3776                                  
  3777                                  
  3778 00001655 1E2220241F232125        colour_table db 30, 34, 32, 36, 31, 35, 33, 37
  3779                                  
  3780                                  
  3781                                  
  3782 0000165D 20FAFAFAFAFAFAFAFA-     low_ascii_conv db ' ', 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, '><|!|$', 250, '|^v><--^v'
  3782 00001666 FAFAFAFAFAFAFA3E3C-
  3782 0000166F 7C217C24FA7C5E763E-
  3782 00001678 3C2D2D5E76         
  3783                                  
  3784                                  
  3785                                  
  3786 0000167D 48504D4B                unix_cursor_xlt db 0x48, 0x50, 0x4d, 0x4b
  3787                                  
  3788                                  
  3789                                  
  3790 00001681 474F4951                pgup_pgdn_xlt db 0x47, 0x4f, 0x49, 0x51
  3791                                  
  3792                                  
  3793                                  
  3794 00001685 00                      int8_ctr db 0
  3795 00001686 00                      in_update db 0
  3796 00001687 00                      vram_dirty db 0
  3797 00001688 00                      last_attrib db 0
  3798 00001689 00                      int_curpos_x db 0
  3799 0000168A 00                      int_curpos_y db 0
  3800 0000168B 00                      crt_curpos_x_last db 0
  3801 0000168C 00                      crt_curpos_y_last db 0
  3802                                  
  3803                                  
  3804                                  
  3805 0000168D 0000                    last_int8_msec dw 0
  3806 0000168F 00                      last_key_sdl db 0
  3807                                  
  3808                                  
  3809                                  
  3810                                  
  3811                                  
  3812 00001690 0303050506070C03        rm_mode0_reg1 db 3, 3, 5, 5, 6, 7, 12, 3
  3813 00001698 060706070C0C0C0C        rm_mode012_reg2 db 6, 7, 6, 7, 12, 12, 12, 12
  3814 000016A0 0000000000000100        rm_mode0_disp db 0, 0, 0, 0, 0, 0, 1, 0
  3815 000016A8 0B0B0A0A0B0B0B0B        rm_mode0_dfseg db 11, 11, 10, 10, 11, 11, 11, 11
  3816                                  
  3817 000016B0 0303050506070503        rm_mode12_reg1 db 3, 3, 5, 5, 6, 7, 5, 3
  3818 000016B8 0101010101010101        rm_mode12_disp db 1, 1, 1, 1, 1, 1, 1, 1
  3819 000016C0 0B0B0A0A0B0B0A0B        rm_mode12_dfseg db 11, 11, 10, 10, 11, 11, 10, 11
  3820                                  
  3821                                  
  3822                                  
  3823 000016C8 090909090707191A09-     xlat_ids db 9, 9, 9, 9, 7, 7, 25, 26, 9, 9, 9, 9, 7, 7, 25, 48, 9, 9, 9, 9, 7, 7, 25, 26, 9, 9, 9, 9, 7, 7, 25, 26, 9, 9, 9, 9, 7, 7, 27, 28, 9, 9, 9, 9, 7, 7, 27, 28, 9, 9, 9, 9, 7, 7, 27, 29, 9, 9, 9, 9, 7, 7, 27, 29, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 51, 54, 52, 52, 52, 52, 52, 52, 55, 55, 55, 55, 52, 52, 52, 52, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 15, 15, 24, 24, 9, 9, 9, 9, 10, 10, 10, 10, 16, 16, 16, 16, 16, 16, 16, 16, 30, 31, 32, 53, 33, 34, 35, 36, 11, 11, 11, 11, 17, 17, 18, 18, 47, 47, 17, 17, 17, 17, 18, 18, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 12, 12, 19, 19, 37, 37, 20, 20, 49, 50, 19, 19, 38, 39, 40, 19, 12, 12, 12, 12, 41, 42, 43, 44, 53, 53, 53, 53, 53, 53, 53, 53, 13, 13, 13, 13, 21, 21, 22, 22, 14, 14, 14, 14, 21, 21, 22, 22, 53, 0, 23, 23, 53, 45, 6, 6, 46, 46, 46, 46, 46, 46, 5, 5
  3823 000016D1 090909070719300909-
  3823 000016DA 09090707191A090909-
  3823 000016E3 090707191A09090909-
  3823 000016EC 07071B1C0909090907-
  3823 000016F5 071B1C090909090707-
  3823 000016FE 1B1D0909090907071B-
  3823 00001707 1D0202020202020202-
  3823 00001710 020202020202020203-
  3823 00001719 030303030303030404-
  3823 00001722 040404040404333634-
  3823 0000172B 343434343437373737-
  3823 00001734 343434340000000000-
  3823 0000173D 000000000000000000-
  3823 00001746 0000080808080F0F18-
  3823 0000174F 18090909090A0A0A0A-
  3823 00001758 10101010101010101E-
  3823 00001761 1F2035212223240B0B-
  3823 0000176A 0B0B111112122F2F11-
  3823 00001773 111111121201010101-
  3823 0000177C 010101010101010101-
  3823 00001785 0101010C0C13132525-
  3823 0000178E 141431321313262728-
  3823 00001797 130C0C0C0C292A2B2C-
  3823 000017A0 35353535353535350D-
  3823 000017A9 0D0D0D151516160E0E-
  3823 000017B2 0E0E15151616350017-
  3823 000017BB 17352D06062E2E2E2E-
  3823 000017C4 2E2E0505           
  3824 000017C8 000000000000080801-     ex_data db 0, 0, 0, 0, 0, 0, 8, 8, 1, 1, 1, 1, 1, 1, 9, 36, 2, 2, 2, 2, 2, 2, 10, 10, 3, 3, 3, 3, 3, 3, 11, 11, 4, 4, 4, 4, 4, 4, 8, 0, 5, 5, 5, 5, 5, 5, 9, 1, 6, 6, 6, 6, 6, 6, 10, 2, 7, 7, 7, 7, 7, 7, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 21, 21, 21, 21, 21, 21, 0, 0, 0, 0, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 12, 12, 12, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 16, 22, 0, 0, 0, 0, 1, 1, 0, 255, 48, 2, 0, 0, 0, 0, 255, 255, 40, 11, 3, 3, 3, 3, 3, 3, 3, 3, 43, 43, 43, 43, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 21, 0, 0, 2, 40, 21, 21, 80, 81, 92, 93, 94, 95, 0, 0
  3824 000017D1 010101010109240202-
  3824 000017DA 020202020A0A030303-
  3824 000017E3 0303030B0B04040404-
  3824 000017EC 040408000505050505-
  3824 000017F5 050901060606060606-
  3824 000017FE 0A020707070707070B-
  3824 00001807 000000000000000000-
  3824 00001810 010101010101010100-
  3824 00001819 000000000000000000-
  3824 00001822 000000000000000015-
  3824 0000182B 151515151500000000-
  3824 00001834 151515151515151515-
  3824 0000183D 151515151515151515-
  3824 00001846 151500000000000000-
  3824 0000184F 00080808080C0C0C0C-
  3824 00001858 000000000000000000-
  3824 00001861 0000000000FF000000-
  3824 0000186A 000000000000000001-
  3824 00001873 010202010100000000-
  3824 0000187C 000000000000000000-
  3824 00001885 000000010100001016-
  3824 0000188E 00000000010100FF30-
  3824 00001897 0200000000FFFF280B-
  3824 000018A0 03030303030303032B-
  3824 000018A9 2B2B2B000000000000-
  3824 000018B2 000001010101011500-
  3824 000018BB 000228151550515C5D-
  3824 000018C4 5E5F0000           
  3825 000018C8 030303030303000005-     std_flags db 3, 3, 3, 3, 3, 3, 0, 0, 5, 5, 5, 5, 5, 5, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 5, 5, 5, 5, 5, 5, 0, 1, 3, 3, 3, 3, 3, 3, 0, 1, 5, 5, 5, 5, 5, 5, 0, 1, 3, 3, 3, 3, 3, 3, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  3825 000018D1 050505050500000101-
  3825 000018DA 010101010000010101-
  3825 000018E3 010101000005050505-
  3825 000018EC 050500010303030303-
  3825 000018F5 030001050505050505-
  3825 000018FE 000103030303030300-
  3825 00001907 010101010101010101-
  3825 00001910 010101010101010100-
  3825 00001919 000000000000000000-
  3825 00001922 000000000000000000-
  3825 0000192B 000000000000000000-
  3825 00001934 000000000000000000-
  3825 0000193D 000000000000000000-
  3825 00001946 000001010101050500-
  3825 0000194F 000000000000000000-
  3825 00001958 000000000000000000-
  3825 00001961 000000000000000000-
  3825 0000196A 000000000000050500-
  3825 00001973 000000000000000000-
  3825 0000197C 000000000000000000-
  3825 00001985 000000000000000000-
  3825 0000198E 000000000000000000-
  3825 00001997 000000000005050000-
  3825 000019A0 000000000000000000-
  3825 000019A9 000000000000000000-
  3825 000019B2 000000000000000000-
  3825 000019BB 000000000000000000-
  3825 000019C4 00000000           
  3826 000019C8 020202020101010102-     base_size db 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 0, 0, 2, 2, 2, 2, 4, 1, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2
  3826 000019D1 020202010101020202-
  3826 000019DA 020201010101020202-
  3826 000019E3 020101010102020202-
  3826 000019EC 010101010202020201-
  3826 000019F5 010101020202020101-
  3826 000019FE 010102020202010101-
  3826 00001A07 010101010101010101-
  3826 00001A10 010101010101010101-
  3826 00001A19 010101010101010101-
  3826 00001A22 010101010101010101-
  3826 00001A2B 010101010101010101-
  3826 00001A34 010101010202020202-
  3826 00001A3D 020202020202020202-
  3826 00001A46 020202020202020202-
  3826 00001A4F 020202020202020202-
  3826 00001A58 010101010101010101-
  3826 00001A61 010001010101010303-
  3826 00001A6A 030301010101010101-
  3826 00001A73 010101010101010101-
  3826 00001A7C 010101010101010101-
  3826 00001A85 010101030300000202-
  3826 00001A8E 020204010000000000-
  3826 00001A97 000202020202020101-
  3826 00001AA0 020202020202020202-
  3826 00001AA9 020202020202020000-
  3826 00001AB2 000001010101010201-
  3826 00001ABB 010101020201010101-
  3826 00001AC4 01010202           
  3827 00001AC8 000000000101000000-     i_w_adder db 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  3827 00001AD1 000000010100000000-
  3827 00001ADA 000001010000000000-
  3827 00001AE3 000101000000000000-
  3827 00001AEC 010100000000000001-
  3827 00001AF5 010000000000000101-
  3827 00001AFE 000000000000010100-
  3827 00001B07 000000000000000000-
  3827 00001B10 000000000000000000-
  3827 00001B19 000000000000000000-
  3827 00001B22 000000000000000000-
  3827 00001B2B 000000000001010101-
  3827 00001B34 000000000000000000-
  3827 00001B3D 000000000000000000-
  3827 00001B46 000001010101000000-
  3827 00001B4F 000000000000000000-
  3827 00001B58 000000000000000000-
  3827 00001B61 000000000000000000-
  3827 00001B6A 000000000000010100-
  3827 00001B73 000000000001010101-
  3827 00001B7C 010101010101010101-
  3827 00001B85 010101000000000000-
  3827 00001B8E 010100000000000000-
  3827 00001B97 000000000000000000-
  3827 00001BA0 000000000000000000-
  3827 00001BA9 000000000000000000-
  3827 00001BB2 000000000000000000-
  3827 00001BBB 000000000000000000-
  3827 00001BC4 00000000           
  3828 00001BC8 010101010000000001-     i_mod_adder db 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1
  3828 00001BD1 010101000000000101-
  3828 00001BDA 010100000000010101-
  3828 00001BE3 010000000001010101-
  3828 00001BEC 000000000101010100-
  3828 00001BF5 000000010101010000-
  3828 00001BFE 000001010101000000-
  3828 00001C07 000000000000000000-
  3828 00001C10 000000000000000000-
  3828 00001C19 000000000000000000-
  3828 00001C22 000000000000000000-
  3828 00001C2B 000000000000000000-
  3828 00001C34 000000000000000000-
  3828 00001C3D 000000000000000000-
  3828 00001C46 000001010101010101-
  3828 00001C4F 010101010101010101-
  3828 00001C58 000000000000000000-
  3828 00001C61 000000000000000000-
  3828 00001C6A 000000000000000000-
  3828 00001C73 000000000000000000-
  3828 00001C7C 000000000000000000-
  3828 00001C85 000000010100000101-
  3828 00001C8E 010100000000000000-
  3828 00001C97 000101010100000000-
  3828 00001CA0 010101010101010100-
  3828 00001CA9 000000000000000000-
  3828 00001CB2 000000000000000000-
  3828 00001CBB 000000010100000000-
  3828 00001CC4 00000101           
  3829                                  
  3830 00001CC8 000204060708090A0B      flags_mult db 0, 2, 4, 6, 7, 8, 9, 10, 11
  3831                                  
  3832 00001CD1 30282B282C293131        jxx_dec_a db 48, 40, 43, 40, 44, 41, 49, 49
  3833 00001CD9 3131312B3131312B        jxx_dec_b db 49, 49, 49, 43, 49, 49, 49, 43
  3834 00001CE1 3131313131312C2C        jxx_dec_c db 49, 49, 49, 49, 49, 49, 44, 44
  3835 00001CE9 3131313131313030        jxx_dec_d db 49, 49, 49, 49, 49, 49, 48, 48
  3836                                  
  3837 00001CF1 010000010001010000-     parity db 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1
  3837 00001CFA 010100010000010001-
  3837 00001D03 010001000001010000-
  3837 00001D0C 010001010000010100-
  3837 00001D15 010000010100000100-
  3837 00001D1E 010100010000010001-
  3837 00001D27 010000010100010000-
  3837 00001D30 010001010001000001-
  3837 00001D39 010000010001010001-
  3837 00001D42 000001000101000001-
  3837 00001D4B 010001000001010000-
  3837 00001D54 010001010000010100-
  3837 00001D5D 010000010001010001-
  3837 00001D66 000001010000010001-
  3837 00001D6F 010000010100010000-
  3837 00001D78 010100000100010100-
  3837 00001D81 010000010001010000-
  3837 00001D8A 010100010000010100-
  3837 00001D93 000100010100000101-
  3837 00001D9C 000100000100010100-
  3837 00001DA5 010000010100000100-
  3837 00001DAE 010100010000010001-
  3837 00001DB7 010000010100010000-
  3837 00001DC0 010001010001000001-
  3837 00001DC9 010000010001010000-
  3837 00001DD2 010100010000010100-
  3837 00001DDB 000100010100010000-
  3837 00001DE4 010001010000010100-
  3837 00001DED 01000001           
  3838                                  
  3839                                  
  3840                                  
  3841                                  timetable:
  3842                                  
  3843                                  tm_sec equ $
  3844                                  tm_min equ $+4
  3845                                  tm_hour equ $+8
  3846                                  tm_mday equ $+12
  3847                                  tm_mon equ $+16
  3848                                  tm_year equ $+20
  3849                                  tm_wday equ $+24
  3850                                  tm_yday equ $+28
  3851                                  tm_dst equ $+32
  3852                                  tm_msec equ $+36
